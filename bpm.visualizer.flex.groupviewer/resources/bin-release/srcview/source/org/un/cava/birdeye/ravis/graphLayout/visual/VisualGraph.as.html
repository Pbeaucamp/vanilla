<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>VisualGraph.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">/* 
 * The MIT License
 *
 * Copyright (c) 2007 The SixDegrees Project Team
 * (Jason Bellone, Juan Rodriguez, Segolene de Basquiat, Daniel Lang).
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the &quot;Software&quot;), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */</span>
<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">graphLayout</span>.<span class="ActionScriptDefault_Text">visual</span> <span class="ActionScriptBracket/Brace">{</span>
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">display</span>.<span class="ActionScriptDefault_Text">DisplayObject</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">display</span>.<span class="ActionScriptDefault_Text">Graphics</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">MouseEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">Point</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">Rectangle</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">Dictionary</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">containers</span>.<span class="ActionScriptDefault_Text">Canvas</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">controls</span>.<span class="ActionScriptDefault_Text">Label</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">IDataRenderer</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">IFactory</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">UIComponent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">effects</span>.<span class="ActionScriptDefault_Text">Effect</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">EffectEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">ObjectUtil</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">graphLayout</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">graphLayout</span>.<span class="ActionScriptDefault_Text">layout</span>.<span class="ActionScriptDefault_Text">ILayoutAlgorithm</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">graphLayout</span>.<span class="ActionScriptDefault_Text">visual</span>.<span class="ActionScriptDefault_Text">edgeRenderers</span>.<span class="ActionScriptDefault_Text">BaseEdgeRenderer</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">LogUtil</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">VGraphEvent</span>;


    <span class="ActionScriptASDoc">/**
     *  Dispatched when there is any change to the nodes and/or links of this graph.
     *
     *  @eventType org.un.cava.birdeye.ravis.utils.events.VGraphEvent
     */</span>
    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">VGraphEvent</span>.<span class="ActionScriptDefault_Text">VGRAPH_CHANGED</span>, <span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&quot;org.un.cava.birdeye.ravis.utils.events.VGraphEvent&quot;</span><span class="ActionScriptBracket/Brace">)]</span>

    <span class="ActionScriptASDoc">/**
     * This component can visualize and layout a graph data structure in 
     * a Flex application. It is derived from canvas and thus behaves much
     * like that in general.
     * 
     * Currently the graphs are required to be connected. And for most layouts
     * a root node is required (as they are tree based).
     * 
     * A graph object needs to be specified as well as a layouter object
     * that implements the ILayoutAlgorithm interface.
     * 
     * XXX provide example code here
     * */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">VisualGraph</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">Canvas</span> <span class="ActionScriptReserved">implements</span> <span class="ActionScriptDefault_Text">IVisualGraph</span> <span class="ActionScriptBracket/Brace">{</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">_LOG</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;graphLayout.visual.VisualGraph&quot;</span>;        
        
        <span class="ActionScriptASDoc">/**
         * This flag for draw() specifies that the linklength
         * shall be reset to 100 when calling draw();
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">DF_RESET_LL</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 1;
        
        <span class="ActionScriptASDoc">/**
         * We keep a reference to ourselves (this) in this attribute.
         * Not really necessary, but it makes the code more clear if
         * a method is called, that really belongs to the super class.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_canvas</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Canvas</span>;

        <span class="ActionScriptASDoc">/**
         * This property holds the Graph object with the graph
         * data, that is supposed to be visualised. This is also
         * the only data structure that keeps track of nodes and
         * edges.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_graph</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IGraph</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
    
        <span class="ActionScriptASDoc">/**
         * This property holds the layouter object. The layouter does the 
         * calculation of the layout and the placement of the nodes.
         * It may be exchanged on the fly.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_layouter</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ILayoutAlgorithm</span>;

        <span class="ActionScriptASDoc">/**
         * This is a drawing surface to draw the edges on. It is only
         * used for the edges and is added as a child to the canvas.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_drawingSurface</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>; 

        <span class="ActionScriptASDoc">/**
         * for cleanup we also need a reference source for
         * vnodes and vedges
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_vnodes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_vedges</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;

        <span class="ActionScriptASDoc">/**
         * Every visual node is associated with an UIComponent that 
         * will be the actual visual representation of the node in the
         * Flashplayer. This UIComponent (which is typically an ItemRenderer)
         * is called a &quot;view&quot;. Node&apos;s views are now mainly created on
         * demand and destroyed if the node is currently not visible
         * to save resources. This map keeps track of which VNode belongs
         * to which view. This is required as in certain events, we get
         * only access to the UIComponent and we need to get hold of
         * the corresponding node.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_viewToVNodeMap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;

        <span class="ActionScriptASDoc">/**
         * A similar map needs to exist for edges
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_viewToVEdgeMap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;
        
        <span class="ActionScriptASDoc">/**
         * The standard origin is the upper left corner, but if
         * the graph is scrolled, this origin may change, so we keep
         * track of that here.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_origin</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Point</span>;
        
        <span class="ActionScriptASDoc">/**
         * The current zooming scale of the vgraph.
         * This is used to facilitate the use of scaleX/scaleY
         * and take it into account for drag and drop.
         * Supported by getter/setting methods.
         * (Contributed by Ivan Bulanov)
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_scale</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1;
        
        <span class="ActionScriptComment">/* drag and drop support */</span>
        
        <span class="ActionScriptASDoc">/**
         * This is the current UIComponent that is dragged by the mouse.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_dragComponent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;

        <span class="ActionScriptASDoc">/**
         * These two maps keep the drag cursor offset positions
         * for each dragged component. This allows to (theoretically)
         * drag more than one component at once and to correctly reposition the
         * component during the drag and at the drop.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;
        
        <span class="ActionScriptASDoc">/**
         * There is generally support to restrict dragging and dropping
         * to a certain area. These bounds are kept for each dragged
         * component in this map.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_drag_boundsMap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;

        <span class="ActionScriptASDoc">/**
         * The drag cursors starting position is required
         * if we do a &quot;background drag&quot;, i.e. scroll the whole
         * VisualGraph around. All this does is basically moving all
         * components with the mouse, thus creating the effect of a 
         * background drag.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_dragCursorStartX</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_dragCursorStartY</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        
        <span class="ActionScriptASDoc">/**
         * To distinguish an active mouse move drag that drags
         * a component from one that should drag the background, 
         * we need this property.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_backgroundDragInProgress</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                
        <span class="ActionScriptASDoc">/**
         * To enable/disable scrolling while background is being
         * dragged 
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_scrollBackgroundInDrag</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        
        <span class="ActionScriptASDoc">/**
         * To enable/disable movement while node is being
         * dragged 
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_moveNodeInDrag</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;

        <span class="ActionScriptASDoc">/**
         * To enable/disable movement while edge is being
         * dragged 
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_moveEdgeInDrag</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        
        <span class="ActionScriptASDoc">/**
         * To enable/disable movement while background is being
         * dragged 
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_moveGraphInDrag</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        
        <span class="ActionScriptComment">/* Rendering */</span>

        <span class="ActionScriptASDoc">/**
         * We allow the specification of an EdgeRenderer object
         * that draws the Edges using the graphics part of the
         * drawing surface.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_edgeRenderer</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdgeRenderer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;

        <span class="ActionScriptASDoc">/**
         * We allow the specification of an ItemRenderer (i.e. an IFactory)
         * that allows us to specify the view&apos;s for each node in MXML
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_itemRendererFactory</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IFactory</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
        
        <span class="ActionScriptASDoc">/**
         * Also allow the specification of an IFactory for edge
         * labels.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_edgeLabelRendererFactory</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IFactory</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
        
        <span class="ActionScriptASDoc">/**
         * Flag to force a redraw of all edge even if the layout
         * has not changed
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_forceUpdateEdges</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        
        <span class="ActionScriptASDoc">/**
         * Specify whether edge labels should be displayed or not
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_displayEdgeLabels</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        
        <span class="ActionScriptComment">/* Spring Graph also allowed a specification of an IViewFactory
         * which is a custom implementation of a factory that returns
         * UIComponents to be used as a view for a node.
         * Currently not implemented, nor needed.
        protected var _viewFactory:IViewFactory = null;
         */</span>

        <span class="ActionScriptASDoc">/**
         * We keep the default parameters
         * to draw edges (line width, color, alpha channel)
         * in this object. The params to be expected are all
         * params which can be accepted by the lineStyle()
         * method of the Graphics class.
         * We keep a separate default set for regular edges and
         * for distinguished edges.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_defaultEdgeStyle</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">thickness</span><span class="ActionScriptOperator">:</span>1,
            <span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptOperator">:</span>1.0,
            <span class="ActionScriptDefault_Text">color</span><span class="ActionScriptOperator">:</span>0<span class="ActionScriptDefault_Text">xcccccc</span>,
            <span class="ActionScriptDefault_Text">pixelHinting</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">false</span>,
            <span class="ActionScriptDefault_Text">scaleMode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptString">&quot;normal&quot;</span>,
            <span class="ActionScriptDefault_Text">caps</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">null</span>,
            <span class="ActionScriptDefault_Text">joints</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">null</span>,
            <span class="ActionScriptDefault_Text">miterLimit</span><span class="ActionScriptOperator">:</span>3
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">/* currently inactive *
        protected var _defaultDistEdgeSettings:Object = {
            thickness:1,
            alpha:1.0,
            color:0xff0000,
            pixelhinting:false,
            scaleMode:&quot;normal&quot;,
            caps:null,
            joints:null,
            miterLimit:3
        }
        */</span>

        <span class="ActionScriptComment">/* The visibility of nodes can be controlled in a few ways.
         * The principal limit is to restrict nodes to only be visible if they
         * are within a certain distance (in degrees of separation) from the
         * current root node. In addition previous root nodes can be
         * made visible */</span>

        <span class="ActionScriptASDoc">/**
         * This property controls if any visibility limit is currently
         * active at all. Strongly recommended for large graphs.
         * The application will be brought to its knees if thousands of nodes
         * should be displayed. 
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_visibilityLimitActive</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        
        <span class="ActionScriptASDoc">/**
         * Controls the maximum distance from the root that a node
         * can have to still be visible.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_maxVisibleDistance</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uint</span>.<span class="ActionScriptDefault_Text">MAX_VALUE</span>;

        <span class="ActionScriptASDoc">/**
         * This object hash contains all node ids 
         * of nodes which are currently within the visible
         * distance limit. This hash is typically initialised from
         * from the Graph object. These nodes are NOT all
         * visible nodes (since the history nodes are also
         * visible).
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_nodeIDsWithinDistanceLimit</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;
        
        <span class="ActionScriptASDoc">/**
         * This object contains the previuos hash of nodes
         * within the distance. To keep this helps to avoid
         * running through all nodes to render the olds
         * invisible and the new ones visible.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_prevNodeIDsWithinDistanceLimit</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;
        
        <span class="ActionScriptASDoc">/**
         * This is the number of nodes within the distance
         * limit.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_noNodesWithinDistance</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span>;
        
        <span class="ActionScriptASDoc">/**
         * This Dictionary holds all visible nodes,
         * i.e. those within the limit and the history
         * nodes (if the history is enabled), or even all
         * nodes, if the visibility limitation is disabled.
         * This directory is indexed by VNode and the values
         * are the same VNode.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_visibleVNodes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;
        
        <span class="ActionScriptASDoc">/**
         * The number of currently visible VNodes.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_noVisibleVNodes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
        
        <span class="ActionScriptASDoc">/**
         * This Dictionary keeps track of all currently
         * visible edges. An edge is visible iff both
         * attached nodes are visible. This hash is indexed
         * with VEdges and the values are the same VEdge objects.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_visibleVEdges</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;
        
        <span class="ActionScriptComment">/* root nodes, distinguished nodes and history */</span>
        
        <span class="ActionScriptASDoc">/**
         * This is the current focused / root node. It will be
         * used as the root for any tree computations and
         * currently all layouters depend on this.
         * Typically the root node is selected by double-click.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_currentRootVNode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
    
        <span class="ActionScriptASDoc">/**
         * This hash keeps track of all the past root VNodes
         * thus being the history. If showHistory is enabled,
         * these nodes are also visible even if they are outside
         * the visible distance.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_currentVNodeHistory</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
        
        <span class="ActionScriptASDoc">/**
         * This flag controls whether to show the history nodes or not.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_showCurrentNodeHistory</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;

        <span class="ActionScriptComment">/* for debugging purposes we need a component counter */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_componentCounter</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;

        <span class="ActionScriptComment">/* public attributes */</span>

        <span class="ActionScriptASDoc">/**
         * enable bitmap caching in renderer components
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cacheRendererObjects</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;

        <span class="ActionScriptASDoc">/**
         * Default visibility setting for new nodes. If
         * set all new nodes are created visible and with
         * a view component. Beware of that if you have
         * many nodes.
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">newNodesDefaultVisible</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;

        <span class="ActionScriptASDoc">/**
         * This property controls whether the mouse cursor
         * should be locked in the dragged node&apos;s center or not.
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dragLockCenter</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;

        <span class="ActionScriptASDoc">/**
         * If set, this effect will be applied if a view
         * is created (e.g. while a node becomes visible
         * or if a new node is created).
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">addItemEffect</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Effect</span>;
        
        <span class="ActionScriptASDoc">/**
         * If set, this effect will be applied if a view
         * is removed (e.g. a node becomes invisible or
         * is removed).
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">removeItemEffect</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Effect</span>;

        <span class="ActionScriptASDoc">/**
         * The constructor just initialises most data structures, but not all
         * required. Currently it does neither set a Graph object, nor a 
         * Layouter object. Reasonable defaults may be added as an option.
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">VisualGraph</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptComment">/* call super class constructor */</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptComment">/* initialize maps for drag and drop */</span>
            <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
            <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
            <span class="ActionScriptDefault_Text">_drag_boundsMap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
            
            <span class="ActionScriptComment">/* initialise view/ItemRenderer and visibility mapping */</span>
            <span class="ActionScriptDefault_Text">_vnodes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
            <span class="ActionScriptDefault_Text">_vedges</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
            <span class="ActionScriptDefault_Text">_viewToVNodeMap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
            <span class="ActionScriptDefault_Text">_viewToVEdgeMap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
            <span class="ActionScriptDefault_Text">_visibleVNodes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
            <span class="ActionScriptDefault_Text">_visibleVEdges</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
            <span class="ActionScriptDefault_Text">_noVisibleVNodes</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">_visibilityLimitActive</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            
            <span class="ActionScriptComment">/* init the history array */</span>
            <span class="ActionScriptDefault_Text">_currentVNodeHistory</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span>;
            
            <span class="ActionScriptComment">/* set the drawing surface for the edges */</span>
            <span class="ActionScriptDefault_Text">_drawingSurface</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptComment">/* set an edge renderer, for now we use the Default,
             * but at a later stage this could be set externally */</span>
            <span class="ActionScriptDefault_Text">_edgeRenderer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BaseEdgeRenderer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_drawingSurface</span>.<span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* initialize the canvas, we are our own canvas obviously */</span>
            <span class="ActionScriptComment">//_canvas = this;
</span>            
            <span class="ActionScriptComment">/* Fix ScrollBar problem*/</span>
            <span class="ActionScriptDefault_Text">_canvas</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Canvas</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">setStyle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;backgroundColor&quot;</span>, 0<span class="ActionScriptDefault_Text">xFFFFFF</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">setStyle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;backgroundAlpha&quot;</span>, 0.0000001<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_canvas</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_drawingSurface</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* disable scrollbars */</span>
            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">verticalScrollPolicy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;off&quot;</span>;
            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">horizontalScrollPolicy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;off&quot;</span>;
            
            <span class="ActionScriptComment">/* add event handlers for background drag/drop i.e. scrolling */</span>
            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_DOWN</span>,<span class="ActionScriptDefault_Text">backgroundDragBegin</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* Optimize drag and drop, Only add event listener for mouse up if there is mouse move event. */</span>
            <span class="ActionScriptComment">//_canvas.addEventListener(MouseEvent.MOUSE_UP,dragEnd);
</span>            
            <span class="ActionScriptDefault_Text">_origin</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>0,0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * This property allows access and setting of the underlying
         * graph object. If set, it will automatically initialise the VGraph
         * from the Graph object, i.e. create VNodes and VEdges for each
         * Graph node and Graph edge.
         * If there was already a Graph present, the VGraph is purged, but no other
         * cleanup is done, which means that there could still be
         * some references floating around thus leaking memory.
         * For now, avoid setting it more than once in the same
         * VGraph.
         * @param g The Graph object to be assigned.
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">g</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IGraph</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>

            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;_graph in VisualGraph was not null when new graph was assigned.&quot;</span><span class="ActionScriptOperator">+</span>
                    <span class="ActionScriptString">&quot; Some cleanup done, but this may leak memory&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">/* this cleanes the VGraph so we are pristine */</span>
                <span class="ActionScriptDefault_Text">clearHistory</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">purgeVGraph</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">purgeGraph</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">_nodeIDsWithinDistanceLimit</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptDefault_Text">_prevNodeIDsWithinDistanceLimit</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptDefault_Text">_noNodesWithinDistance</span> <span class="ActionScriptOperator">=</span> 0;
            
                <span class="ActionScriptComment">/* this may have been removed already before */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">resetAll</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* assign defaults */</span>
            <span class="ActionScriptDefault_Text">_graph</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">g</span>;
            
            <span class="ActionScriptComment">/* IMPORTANT: a layouter also has a graph reference
             * separate, this must be updated in order for
             * this to work properly
             */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">graph</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">g</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* better safe than sorry even if it is an empty one */</span>
            <span class="ActionScriptDefault_Text">initFromGraph</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptComment">/* invalidate old root node */</span>
            <span class="ActionScriptDefault_Text">_currentRootVNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            
            <span class="ActionScriptComment">/* now use the first node as the new default root node */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">nodes</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_currentRootVNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">nodes</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">INode</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">vnode</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;Setting a new graph object invalidates the root node,&quot;</span><span class="ActionScriptOperator">+</span>
                <span class="ActionScriptString">&quot; a new default root node was set, but it may not be what you want&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IGraph</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_graph</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">edgeDrawGraphics</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Graphics</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_drawingSurface</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_drawingSurface</span>.<span class="ActionScriptDefault_Text">graphics</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">drawingSurface</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_drawingSurface</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">itemRenderer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ifac</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IFactory</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ifac</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_itemRendererFactory</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_itemRendererFactory</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ifac</span>;
                
                <span class="ActionScriptComment">/* if that has changed, we would need to recreate all
                 * currently visible nodes */</span>
                <span class="ActionScriptDefault_Text">setAllInVisible</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">updateVisibility</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">itemRenderer</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IFactory</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_itemRendererFactory</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">edgeRenderer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">er</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdgeRenderer</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_edgeRenderer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">er</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">edgeRenderer</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdgeRenderer</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_edgeRenderer</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">edgeLabelRenderer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">elr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IFactory</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">/* if the factory was changed, then we have to remove all
             * instances of vedgeViews to have them updated */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">elr</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_edgeLabelRendererFactory</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">/* set all edges invisible, this should delete all instances
                 * of view components */</span>
                <span class="ActionScriptDefault_Text">setAllEdgesInVisible</span><span class="ActionScriptBracket/Brace">()</span>;
            
                <span class="ActionScriptComment">/* set the new renderer */</span>
                <span class="ActionScriptDefault_Text">_edgeLabelRendererFactory</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">elr</span>;    
                
                <span class="ActionScriptComment">/* update i.e. recreate the instances */</span>
                <span class="ActionScriptDefault_Text">updateEdgeVisibility</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">edgeLabelRenderer</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IFactory</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_edgeLabelRendererFactory</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">displayEdgeLabels</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">del</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_displayEdgeLabels</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">del</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// no change
</span>            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_displayEdgeLabels</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">del</span>;
                <span class="ActionScriptDefault_Text">setAllEdgesInVisible</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">updateEdgeVisibility</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">displayEdgeLabels</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_displayEdgeLabels</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">layouter</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ILayoutAlgorithm</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_layouter</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    
        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">layouter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ILayoutAlgorithm</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">resetAll</span><span class="ActionScriptBracket/Brace">()</span>; <span class="ActionScriptComment">// to stop any pending animations
</span>            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">_layouter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">l</span>;
            
            <span class="ActionScriptComment">/* need to signal control components possibly */</span>
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">VGraphEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VGraphEvent</span>.<span class="ActionScriptDefault_Text">LAYOUTER_CHANGED</span><span class="ActionScriptBracket/Brace">))</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">origin</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_origin</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">center</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">/</span> 2.0, <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">/</span> 2.0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">visibleVNodes</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_visibleVNodes</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">noVisibleVNodes</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_noVisibleVNodes</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">visibleVEdges</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_visibleVEdges</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">visibilityLimitActive</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_visibilityLimitActive</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">visibilityLimitActive</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ac</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">/* check for a change */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_visibilityLimitActive</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">ac</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>    
                <span class="ActionScriptComment">/* execute the change */</span>
                <span class="ActionScriptDefault_Text">_visibilityLimitActive</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ac</span>;
                <span class="ActionScriptComment">/* activate? */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ac</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_currentRootVNode</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;No root selected, not creating limited graph, not doing anything.&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">return</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;getting limited node ids with limit:&quot;+_maxVisibleDistance);
</span>                    
                    <span class="ActionScriptComment">/* 1. Get the spanning tree, rooted in our current root node from
                     *    the graph object.
                     * 2. Get the hash from this tree, that contains only the nodes
                     *    within the set distance.
                     * 3. Use this to set our properties for the nodes within the distance
                     *    limit.
                     */</span>
                    <span class="ActionScriptDefault_Text">setDistanceLimitedNodeIds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">getTree</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_currentRootVNode</span>.<span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span>.
                        <span class="ActionScriptDefault_Text">getLimitedNodes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_maxVisibleDistance</span><span class="ActionScriptBracket/Brace">))</span>;
                    
                    <span class="ActionScriptComment">/* now update all other visibility data structure
                     * this also forces a redraw() (and layout) of the 
                     * visualisation */</span>
                    <span class="ActionScriptDefault_Text">updateVisibility</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptComment">/* when we deactivate this limit, we render all nodes
                 * visible! */</span>
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">setAllVisible</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">maxVisibleDistance</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_maxVisibleDistance</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">maxVisibleDistance</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">/* check if there was a change */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_maxVisibleDistance</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">md</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">/* if yes, apply the change */</span>
                <span class="ActionScriptDefault_Text">_maxVisibleDistance</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">md</span>;
                <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;visible distance changed to: &quot;+md);
</span>                
                <span class="ActionScriptComment">/* if our current limits are active we create a new
                 * set of nodes within the distance and update the
                 * visibility */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_visibilityLimitActive</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_currentRootVNode</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;No root selected, not creating limited graph&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">return</span>;
                    <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">setDistanceLimitedNodeIds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">getTree</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_currentRootVNode</span>.<span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span>.
                            <span class="ActionScriptDefault_Text">getLimitedNodes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_maxVisibleDistance</span><span class="ActionScriptBracket/Brace">))</span>;
                        <span class="ActionScriptDefault_Text">updateVisibility</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * This was added for testing. It may be removed
         * again.
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">currentRootSID</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_currentRootVNode</span>.<span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">stringid</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">currentRootVNode</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_currentRootVNode</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">currentRootVNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">/* check for a change */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_currentRootVNode</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptComment">/* apply the change */</span>
                <span class="ActionScriptDefault_Text">_currentRootVNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn</span>;

                <span class="ActionScriptComment">/* now update the history with the new node */</span>
                <span class="ActionScriptDefault_Text">_currentVNodeHistory</span>.<span class="ActionScriptDefault_Text">unshift</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_currentRootVNode</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;node:&quot;+_currentRootVNode.id+&quot; added to history&quot;);
</span>                
                <span class="ActionScriptComment">/* if we are currently limiting node visibility,
                 * update the set of visible nodes since we 
                 * have changed the root, the spanning tree has changed
                 * and thus the set of visible nodes */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_visibilityLimitActive</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">setDistanceLimitedNodeIds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">getTree</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_currentRootVNode</span>.<span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span>.
                        <span class="ActionScriptDefault_Text">getLimitedNodes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_maxVisibleDistance</span><span class="ActionScriptBracket/Brace">))</span>;
                    <span class="ActionScriptDefault_Text">updateVisibility</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">/* if we do not limit visibility, we still need
                     * to force a new layout and redraw()
                     * (in the other case, this is done by updateVisibility()) */</span>
                    <span class="ActionScriptComment">// disabled to remove implicit call to
</span>                    <span class="ActionScriptComment">// draw();
</span>                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>        

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">scrollBackgroundInDrag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">f</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_scrollBackgroundInDrag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">f</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">moveNodeInDrag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">f</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_moveNodeInDrag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">f</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">showHistory</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_showCurrentNodeHistory</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">showHistory</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">h</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">/* check for a change */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_showCurrentNodeHistory</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">h</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_showCurrentNodeHistory</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">h</span>;
            
                <span class="ActionScriptComment">/* makes no sense without root set */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_currentRootVNode</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">/* becomes only active if we have the limit active */</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_visibilityLimitActive</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">/* now update the visibility. This also applies the
                         * history information to the node visibility */</span>
                        <span class="ActionScriptDefault_Text">updateVisibility</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">scale</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_scale</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">curScale</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptDefault_Text">curScale</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">scaleY</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parentComp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">parent</span>;
            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentComp</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentComp</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">VisualGraph</span><span class="ActionScriptBracket/Brace">))</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">curScale</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">parentComp</span>.<span class="ActionScriptDefault_Text">scaleY</span>;
                <span class="ActionScriptDefault_Text">parentComp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parentComp</span>.<span class="ActionScriptDefault_Text">parent</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">curScale</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">curScale</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptDefault_Text">curScale</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">scaleX</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parentComp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">parent</span>;
            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentComp</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentComp</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">VisualGraph</span><span class="ActionScriptBracket/Brace">))</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">curScale</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">parentComp</span>.<span class="ActionScriptDefault_Text">scaleX</span>;
                <span class="ActionScriptDefault_Text">parentComp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parentComp</span>.<span class="ActionScriptDefault_Text">parent</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">curScale</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">scale</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">s</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">/* get the current value */</span>
            <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">s0</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleX</span>;
            <span class="ActionScriptComment">/* set the new value */</span>
            
            <span class="ActionScriptComment">/* Fix Scaling problem (Scrollbar shouldn&apos;t scale with graph)*/</span>    
            <span class="ActionScriptComment">//scaleX = s;
</span>            <span class="ActionScriptComment">//scaleY = s;
</span>            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s</span>;
            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s</span>;
            <span class="ActionScriptComment">/* scroll to the center */</span>
            <span class="ActionScriptDefault_Text">scroll</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">center</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">s</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">s0</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">s</span>, <span class="ActionScriptDefault_Text">center</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">s</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">s0</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">s</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">/* redraw the edges */</span>
            <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptComment">/* remember the set value, this is probably unnecesary
             * since the getter could just return the value of scaleX
             * but anyway */</span>
            <span class="ActionScriptDefault_Text">_scale</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * This initialises a VGraph from a Graph object.
         * I.e. it crates a VNode for every Node found in
         * the Graph and a VEdge for every Edge in the Graph.
         * Careful, this currently does not check if the VGraph
         * was already initialised and it does not purge anything.
         * Things could break of used on an already initialized VGraph.
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">initFromGraph</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">node</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">edge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span>;
            
            <span class="ActionScriptComment">/* create the vnode from the node */</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">nodes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">createVNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;created VNode for node:&quot;+node.id);
</span>            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* we also create the edge objects, since they
             * may carry additional label information or something
             * like that, but they do not have a view */</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">edge</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">edges</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">createVEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">edge</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">clearHistory</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_currentVNodeHistory</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>



        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">calcNodesBoundingBox</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Rectangle</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">children</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">result</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Rectangle</span>;
            
            <span class="ActionScriptComment">/* get all children of our canvas, these should only
             * be node views and the edge drawing surface. */</span>
            <span class="ActionScriptDefault_Text">children</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">getChildren</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptComment">/* init the rectangle with some large values. 
             * Originally I wanted to use Number.MAX_VALUE / Number.MIN_VALUE but
             * ran into serious numerical problems, thus 
             * we use +/- 999999 for now, although this is 
             * more like a hack.
             * Note that the coordinates are reversed, i.e. the origin of the rectangle
             * has been pushed to the far bottom right, and the height and width
             * are negative */</span>
            <span class="ActionScriptDefault_Text">result</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Rectangle</span><span class="ActionScriptBracket/Brace">(</span>999999, 999999, <span class="ActionScriptOperator">-</span>999999, <span class="ActionScriptOperator">-</span>999999<span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;THIS CANVAS currently HAS:&quot;+children.length+&quot; children!!&quot;);
</span>
            <span class="ActionScriptComment">/* if there are no children at all, there may be something
             * wrong as it should at least contain the drawing surface */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">children</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;Canvas has no children, not even the drawing surface!&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* The children should only be the visible node&apos;s views and
             * the drawing surface for the edges, so we
             * add a safeguard here to see of these are actually much more */</span>
            
            <span class="ActionScriptComment">/* since the edge labels were introduced this no longer works
             * because we also need to count each displayed edge label
             * but we have no counter yet for that, so the check is commented
             * for now
            if(children.length &gt; _noVisibleVNodes + 1) {
                throw Error(&quot;Children are more than visible nodes plus drawing surface&quot;);
            }
            */</span>
            
            <span class="ActionScriptComment">/* now walk through all children, which are UIComponents
             * and not our drawing surface and expand the result rectangle */</span>
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;<span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">children</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">children</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">/* only consider currently visible views */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">view</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_drawingSurface</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">result</span>.<span class="ActionScriptDefault_Text">left</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">min</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">result</span>.<span class="ActionScriptDefault_Text">left</span>, <span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">result</span>.<span class="ActionScriptDefault_Text">right</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">max</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">result</span>.<span class="ActionScriptDefault_Text">right</span>, <span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">width</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">result</span>.<span class="ActionScriptDefault_Text">top</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">min</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">result</span>.<span class="ActionScriptDefault_Text">top</span>, <span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">result</span>.<span class="ActionScriptDefault_Text">bottom</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">max</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">result</span>.<span class="ActionScriptDefault_Text">bottom</span>, <span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">height</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">children</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptComment">/* only child is the drawing surface, we return an empty Rectangle
                             * anchored in the middle */</span>
                            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Rectangle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">/</span> 2, <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">/</span> 2, 0, 0<span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">result</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** 
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sid</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>, <span class="ActionScriptDefault_Text">o</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">gnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            
            <span class="ActionScriptComment">/* first add a new node to the underlying graph */</span>
            <span class="ActionScriptDefault_Text">gnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">createNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sid</span>,<span class="ActionScriptDefault_Text">o</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* Then create the VNode with associated with the graph node */</span>
            <span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createVNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">gnode</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* since it is a requirement from most layouters
             * to always have a current root node
             * we assign the current root node to the newly
             * created node so we have one. Note that this does
             * not affect the root node history. */</span>
            <span class="ActionScriptDefault_Text">_currentRootVNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vnode</span>;

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">vnode</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            
            <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">node</span>;
                    
            <span class="ActionScriptComment">/* if the current root node is the
             * node to be removed it must be
             * changed.
             *
             * First, we set it to null, then we remove the
             * node, then at the end we reset it
             * to the first node still in the
             * nodes array */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">_currentRootVNode</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">/* temporary set to null */</span>
                <span class="ActionScriptDefault_Text">_currentRootVNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* remove all incoming edges */</span>
            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">inEdges</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">inEdges</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">IEdge</span>;
                <span class="ActionScriptDefault_Text">ve</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">vedge</span>;
                <span class="ActionScriptDefault_Text">removeVEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">removeEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* remove all outgoing edges */</span>
            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">outEdges</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">outEdges</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">IEdge</span>;
                <span class="ActionScriptDefault_Text">ve</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">vedge</span>;
                <span class="ActionScriptDefault_Text">removeVEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">removeEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* remove the vnode */</span>
            <span class="ActionScriptDefault_Text">removeVNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* remove the node from the graph */</span>
            <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">removeNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* now set a new root node, implies that there is
             * still a node */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_currentRootVNode</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">noNodes</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_currentRootVNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">nodes</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">INode</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">vnode</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* since we removed also edges, we need a refresh */</span>
            <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    
        
        <span class="ActionScriptASDoc">/** 
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">linkNodes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>, <span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            
            <span class="ActionScriptComment">/* make sure both nodes do exist */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v1</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">v2</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;linkNodes: one of the nodes does not exist&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">//return null;
</span>            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">n1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v1</span>.<span class="ActionScriptDefault_Text">node</span>;
            <span class="ActionScriptDefault_Text">n2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v2</span>.<span class="ActionScriptDefault_Text">node</span>;
            
            <span class="ActionScriptComment">/* now first link the graph nodes and create the corresponding edge */</span>
            <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">link</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n1</span>,<span class="ActionScriptDefault_Text">n2</span>,<span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* if the edge existed already, e is just the
             * already existing edge. But if it existed
             * previously it might already have a VEdge.
             * So we only create a new VEdge, if it did not exist
             * already. */</span>        
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Could not create or find Graph edge!!&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">vedge</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">/* we have a new edge, so we create a new VEdge */</span>
                    <span class="ActionScriptDefault_Text">ve</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createVEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">/* existing one, so we use the existing vedge */</span>
                    <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">info</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;Edge already existed, returning existing vedge&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">ve</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">vedge</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
    
            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;linkNodes, created edge &quot;+(e as Object).toString()+&quot; from nodes: &quot;+n1.id+&quot;, &quot;+n2.id);
</span>
            <span class="ActionScriptComment">/* this changes the layout, so we have to do a full redraw */</span>
            <span class="ActionScriptComment">// if we link nodes we may not necesarily want to draw();
</span>            <span class="ActionScriptComment">/* just refresh the edges */</span>
            <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">ve</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/** 
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">unlinkNodes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>, <span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            
            <span class="ActionScriptComment">/* make sure both nodes exist */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v1</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">v2</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;unlink nodes: one of the nodes does not exist&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">n1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v1</span>.<span class="ActionScriptDefault_Text">node</span>;
            <span class="ActionScriptDefault_Text">n2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v2</span>.<span class="ActionScriptDefault_Text">node</span>;
            
            <span class="ActionScriptComment">/* find the graph edge */</span>
            <span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">getEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n1</span>,<span class="ActionScriptDefault_Text">n2</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* if we do not get an edge, it may simply not exist */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;No edge found between: &quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">n1</span>.<span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot; and &quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">n2</span>.<span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* now get and remove the VEdge first */</span>
            <span class="ActionScriptDefault_Text">ve</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">vedge</span>;            
            <span class="ActionScriptDefault_Text">removeVEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">)</span>;
    
            <span class="ActionScriptComment">/* now remove the edge itself, basically
             * unlinking the nodes */</span>
            <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">removeEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;removed edge: &quot;+e.id+&quot; : &quot;+n1.id+&quot; and &quot;+n2.id);            
</span>            
            <span class="ActionScriptComment">/* again a full redraw is required */</span>
            <span class="ActionScriptComment">//draw();
</span>            <span class="ActionScriptComment">/* no just refresh the edges */</span>
            <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>


        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">scroll</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">deltaX</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">deltaY</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">children</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
            
            <span class="ActionScriptDefault_Text">children</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">getChildren</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptComment">/* we walk through all children of the canvas, which
             * are not the drawing surface and which are UIComponents
             * (they should be all node views) and move them according
             * to the scroll offset */</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">view</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">children</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">view</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_drawingSurface</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;scrolling view of:&quot;+(view as IDataRenderer).data.id);
</span>                    <span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">deltaX</span>;
                    <span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">deltaY</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* adjust the current origin of the canvas
             * (not 100% sure if this is a good idea but seems
             * to work) XXX */</span>
            <span class="ActionScriptDefault_Text">_origin</span>.<span class="ActionScriptDefault_Text">offset</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">deltaX</span>,<span class="ActionScriptDefault_Text">deltaY</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;Setting new origin to:&quot;+_origin.toString());
</span>        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">/* this forces the next call of updateDisplayList()
             * to redraw all edges */</span>
            <span class="ActionScriptDefault_Text">_forceUpdateEdges</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptComment">//_canvas.invalidateDisplayList();
</span>            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">invalidateDisplayList</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">flags</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>    
            
            <span class="ActionScriptComment">/* first refresh does layoutChanges to true and
             * invalidate display list */</span>
            <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">flags</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">VisualGraph</span>.<span class="ActionScriptDefault_Text">DF_RESET_LL</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">linkLength</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">linkLength</span> <span class="ActionScriptOperator">=</span> 100;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* we need to do some sanity checks, e.g. if the canvas window
             * size was reduced to 0 or linklength 0 or similar things,
             * the layouter might crash */</span>
            
            <span class="ActionScriptComment">/* then force a layout pass in the layouter */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span> <span class="ActionScriptOperator">&amp;&amp;</span> 
                <span class="ActionScriptDefault_Text">_currentRootVNode</span> <span class="ActionScriptOperator">&amp;&amp;</span>
                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">noNodes</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span>
                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span>
                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span>
                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">linkLength</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">layoutPass</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* after the layout was done, the layout has
             * probably changed again, the layouter will have
             * itself set to that, but has maybe not
             * invalidated the display list, so we make sure it
             * happens here (may not always be necessary) */</span>
            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">invalidateDisplayList</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptComment">/* dispatch this change event, so some UI items
             * in the application can poll for updated values
             * for labels or something.
             * XXX To do: specify a subtype for more specific changes
             */</span>
             
            <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">VGraphEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VGraphEvent</span>.<span class="ActionScriptDefault_Text">VGRAPH_CHANGED</span><span class="ActionScriptBracket/Brace">))</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
          * Refresh the VGraph fully. I.e. recreate and
          * reassign all data objects, etc.
          * This is a heavy operation */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">fullVGraphRefresh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xmlData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">directional</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">graph</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IGraph</span>;    
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">oldroot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">oldsid</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">newroot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">theXMLData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xmlData</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layouter</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ILayoutAlgorithm</span>;
            
            <span class="ActionScriptComment">/* if we do not have been passed an XML object
             * we try to get one from the old graph */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">theXMLData</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_graph</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">theXMLData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">xmlData</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* still null? then we have to bail out */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">theXMLData</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;No XML object passed or found in old graph&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* reset layouter and remember it */</span>            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">resetAll</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">layouter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_layouter</span>;
                <span class="ActionScriptDefault_Text">_layouter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* init a graph object with the XML data */</span>
            <span class="ActionScriptDefault_Text">graph</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Graph</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;myXMLbasedGraphID&quot;</span>,<span class="ActionScriptDefault_Text">directional</span>,<span class="ActionScriptDefault_Text">theXMLData</span><span class="ActionScriptBracket/Brace">)</span>;
                        
            <span class="ActionScriptComment">/* remember the old root and id */</span>
            <span class="ActionScriptDefault_Text">oldroot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_currentRootVNode</span>;
            <span class="ActionScriptDefault_Text">oldsid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">oldroot</span>.<span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">stringid</span>;
            
            <span class="ActionScriptComment">/* reapply the previous layouter 
             * IMPORTANT: this has to be done before the
             * graph object is set, because otherwise the graph
             * attribute in the layouter will not be updated!
             */</span>
            <span class="ActionScriptDefault_Text">_layouter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">layouter</span>;        
            
            
            <span class="ActionScriptComment">/* set the graph in the VGraph object, this automatically
             * initializes the VGraph items */</span>
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">graph</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">graph</span>;
            
            
                    
            <span class="ActionScriptComment">/* setting a new graph invalidated our old root, we need to reset it */</span>
            <span class="ActionScriptComment">/* we try to find a node, that has the same string-id as the old root node */</span>
            <span class="ActionScriptDefault_Text">newroot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">nodeByStringId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">oldsid</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">newroot</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">currentRootVNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">newroot</span>.<span class="ActionScriptDefault_Text">vnode</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Cannot set a default root, bailing out&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* send an event for controls to reapply their currently
             * set values to layouters */</span>
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">VGraphEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VGraphEvent</span>.<span class="ActionScriptDefault_Text">LAYOUTER_CHANGED</span><span class="ActionScriptBracket/Brace">))</span>;
            
            <span class="ActionScriptComment">/* trigger a redraw
             * XXXX think if we should do that here */</span>
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VisualGraph</span>.<span class="ActionScriptDefault_Text">DF_RESET_LL</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>        

        <span class="ActionScriptASDoc">/**
          * this function takes the node with the specified
          * string id and selects it as a root
         * node, automatically centering the layout around it
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">centerNodeByStringId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nodeID</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">newroot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;VGraph has no Graph object, probably not correctly initialised, yet&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">newroot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">nodeByStringId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nodeID</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* if we have a node, set its vnode as the new root */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">newroot</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">/* is it really a new node */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">newroot</span>.<span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_currentRootVNode</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">/* set it */</span>
                    <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">currentRootVNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">newroot</span>.<span class="ActionScriptDefault_Text">vnode</span>;
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">newroot</span>.<span class="ActionScriptDefault_Text">vnode</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_currentRootVNode</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;Node with id:&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">nodeID</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot; not found!&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
        <span class="ActionScriptBracket/Brace">}</span>



        <span class="ActionScriptASDoc">/**
         * This calls the base updateDisplayList() method of the
         * Canvas and in addition redraws all edges if the layouter
         * indicates that the layout has changed.
         * 
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">updateDisplayList</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unscaledWidth</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">unscaledHeight</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">/* call the original function */</span>
            <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">updateDisplayList</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unscaledWidth</span>,<span class="ActionScriptDefault_Text">unscaledHeight</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">/* invalidate edge and node in _canvas*/</span>
            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">invalidateDisplayList</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptComment">/* now add part to redraw edges */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_forceUpdateEdges</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">layoutChanged</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">redrawEdges</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptComment">/* reset the flags */</span>
                    <span class="ActionScriptDefault_Text">_forceUpdateEdges</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                    <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">layoutChanged</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptComment">/* private methods */</span>

        <span class="ActionScriptASDoc">/**
         * Creates VNode and requires a Graph node to associate
         * it with. Originally also created the view, but we no
         * longer do that directly but only on demand.
         * @param n The graph node to be associated with.
         * @return The created VisualNode.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createVNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            
            <span class="ActionScriptComment">/* as an id we use the id of the graph node for simplicity
             * for now, it is not really used separately anywhere
             * we also use the graph data object as our data object.
             * the view is set to null and remains so. */</span>
            <span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">VisualNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>, <span class="ActionScriptDefault_Text">n</span>, <span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">id</span>, <span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* if the node should be visible by default 
             * we need to make sure that the view is created */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">newNodesDefaultVisible</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setNodeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vnode</span>, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptComment">/* now set the vnode in the node */</span>
            <span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vnode</span>;
            
            <span class="ActionScriptComment">/* add the node to the hash to keep track */</span>
            <span class="ActionScriptDefault_Text">_vnodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vnode</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vnode</span>;
            
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">vnode</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Removes a VNode, this also removes the node&apos;s view
         * if it existed, but does not touch the Graph node.
         * @param vn The VisualNode to be removed.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeVNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
            
            <span class="ActionScriptComment">/* get access to the node&apos;s view, but get the 
             * raw view to avoid unnecessary creation of a view
             */</span>
            <span class="ActionScriptDefault_Text">view</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">rawview</span>;
            
            <span class="ActionScriptComment">/* delete reference to the view from the node */</span>
            <span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">view</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            
            <span class="ActionScriptComment">/* remove the reference to this node from the graph node */</span>
            <span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            
            <span class="ActionScriptComment">/* now remove the view component if it existed */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">view</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">removeComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">view</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* remove from the visible vnode map if present */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_visibleVNodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">undefined</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_visibleVNodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">_noVisibleVNodes</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* remove from tracking hash */</span>
            <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_vnodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptComment">/* this should clean up all references to this VNode
             * thus freeing it for garbage collection */</span>
        <span class="ActionScriptBracket/Brace">}</span>


        <span class="ActionScriptASDoc">/**
         * Creates a VEdge from a graph Edge.
         * @param e The Graph Edge.
         * @return The created VEdge.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createVEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vedge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lStyle</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">edgeAttrs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XMLList</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">attr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">attname</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">attrs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
        
            <span class="ActionScriptComment">/* create a copy of the default style */</span>
            <span class="ActionScriptDefault_Text">lStyle</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ObjectUtil</span>.<span class="ActionScriptDefault_Text">copy</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_defaultEdgeStyle</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* extract style data from associated XML data for each parameter */</span>
            <span class="ActionScriptDefault_Text">attrs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ObjectUtil</span>.<span class="ActionScriptDefault_Text">getClassInfo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lStyle</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">properties</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">attname</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">attrs</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">attribute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">attname</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">lStyle</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">attname</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span>.@<span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">attname</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">vedge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">VisualEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>, <span class="ActionScriptDefault_Text">e</span>, <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">id</span>, <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span>, <span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">lStyle</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* set the VisualEdge reference in the graph edge */</span>
            <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">vedge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vedge</span>;
            
            <span class="ActionScriptComment">/* check if the edge is supposed to be visible */</span>
            <span class="ActionScriptDefault_Text">n1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">node1</span>;
            <span class="ActionScriptDefault_Text">n2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">node2</span>;
            
            <span class="ActionScriptComment">/* if both nodes are visible, the edge should
             * be made visible, which may also create a label
             */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n1</span>.<span class="ActionScriptDefault_Text">vnode</span>.<span class="ActionScriptDefault_Text">isVisible</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">n2</span>.<span class="ActionScriptDefault_Text">vnode</span>.<span class="ActionScriptDefault_Text">isVisible</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setEdgeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vedge</span>, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* add to tracking hash */</span>
            <span class="ActionScriptDefault_Text">_vedges</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vedge</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vedge</span>;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">vedge</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Remove a VisualEdge, but leaves the Graph Edge alone.
         * @param ve The VisualEdge to be removed.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeVEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptComment">/* just in case */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* first turn it invisible, which should
             * remove the labelview */</span>
            <span class="ActionScriptDefault_Text">setEdgeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span>, <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* remove the reference from the real edge */</span>
            <span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">edge</span>.<span class="ActionScriptDefault_Text">vedge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            
            <span class="ActionScriptComment">/* remove from tracking hash */</span>
            <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_vedges</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptComment">/* that should actually do */</span>
        <span class="ActionScriptBracket/Brace">}</span>
    
        <span class="ActionScriptASDoc">/**
         * Purges the VGraph by dropping all VNodes and VEdges.
         * This is a bit tricky, since we do not really
         * keep track of them in the VGraph, they are only referenced
         * by the Graph nodes and egdes.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">purgeVGraph</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ves</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vns</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            
            <span class="ActionScriptComment">/* this appears rather inefficient, however
             * ObjectUtil.copy does not work on dictionaries
             * currently I have no other solution
             */</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_vedges</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">ves</span>.<span class="ActionScriptDefault_Text">unshift</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_vnodes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">vns</span>.<span class="ActionScriptDefault_Text">unshift</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">debug</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;purgeVGraph called&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">ves</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">removeVEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">vns</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">removeVNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;we had no graph to purge from, so nothing was done&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>                
        <span class="ActionScriptBracket/Brace">}</span>
    
        <span class="ActionScriptASDoc">/**
         * Redraw all edges, this is called from the updateDisplayList()
         * method.
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">redrawEdges</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vn1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vn2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">color</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vedge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            
            <span class="ActionScriptComment">/*
            var d:Date = new Date();
            LogUtil.debug(_LOG, &quot;redrawing edges at:&quot;+d.toTimeString());
            */</span>
            
            <span class="ActionScriptComment">/* make sure we have a graph */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">debug</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;_graph object in VisualGraph is null&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
    
            <span class="ActionScriptComment">/* clear the drawing surface and remove previous
             * edges */</span>
            <span class="ActionScriptDefault_Text">_drawingSurface</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">clear</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptComment">/* now walk through all currently visible egdes */</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vedge</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_visibleVEdges</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptComment">/* get the two nodes attached to the edge */</span>
                <span class="ActionScriptDefault_Text">vn1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vedge</span>.<span class="ActionScriptDefault_Text">edge</span>.<span class="ActionScriptDefault_Text">node1</span>.<span class="ActionScriptDefault_Text">vnode</span>;
                <span class="ActionScriptDefault_Text">vn2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vedge</span>.<span class="ActionScriptDefault_Text">edge</span>.<span class="ActionScriptDefault_Text">node2</span>.<span class="ActionScriptDefault_Text">vnode</span>;
                
                <span class="ActionScriptComment">/* all nodes should be visible, so we make an assertion
                 * here */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">vn1</span>.<span class="ActionScriptDefault_Text">isVisible</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">vn2</span>.<span class="ActionScriptDefault_Text">isVisible</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;Edge:&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">vedge</span>.<span class="ActionScriptDefault_Text">id</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">+</span>
                        <span class="ActionScriptString">&quot; Node1:&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">vn1</span>.<span class="ActionScriptDefault_Text">id</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot; vis:&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">vn1</span>.<span class="ActionScriptDefault_Text">isVisible</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">+</span>
                        <span class="ActionScriptString">&quot; Node2:&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">vn2</span>.<span class="ActionScriptDefault_Text">id</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot; vis:&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">vn2</span>.<span class="ActionScriptDefault_Text">isVisible</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">())</span>;
                    <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;One of the nodes of the checked edge is not visible, but should be!&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>

                <span class="ActionScriptComment">/* Change: we do not pass the nodes or the vnodes, but the
                 * edge. The reason is that the edge can have properties
                 * assigned with it that affect the drawing. */</span>
                <span class="ActionScriptDefault_Text">_edgeRenderer</span>.<span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vedge</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">// we are done, so we reset the indicator
</span>            <span class="ActionScriptComment">// we already did that in the outer method 
</span>            <span class="ActionScriptComment">//_layouter.layoutChanged = false;
</span>        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Lookup a node by its UIComponent. This is more a convenience
         * method with some sanity check. Primarily used by event handlers.
         * @param c The component to find the VisualNode for.
         * @return The found Node.
         * @throws An Error if the component was not registered in the map.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">lookupNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewToVNodeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Component not in viewToVNodeMap&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">vn</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        
        <span class="ActionScriptASDoc">/**
         * Create a &quot;view&quot; object (UIComponent) for the given node and
         * return it. These methods are only exported to be used by
         * the VisualNode. Alas, AS does not provide the &quot;friend&quot; directive.
         * Not sure how to get around this problem right now.
         * @param vn The node to replace/add a view object.
         * @return The created view object.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createVNodeComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mycomponent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            
             <span class="ActionScriptComment">/*
              * a possible view factory is our own implementation
              * of such a Factory, currently not used.
             if(_viewFactory != null) {
                 result = viewFactory.getView(VNode) as UIComponent;
             }
             */</span>

            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_itemRendererFactory</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mycomponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_itemRendererFactory</span>.<span class="ActionScriptDefault_Text">newInstance</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mycomponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>            
                
            <span class="ActionScriptComment">/* assigns the item (VisualNode) to the IDataRenderer part of the view
             * this is important to access the data object of the VNode
             * which contains information for rendering. */</span>        
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomponent</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">IDataRenderer</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomponent</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">IDataRenderer</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* set initial x/y values */</span>
            <span class="ActionScriptDefault_Text">mycomponent</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">/</span> 2.0;
            <span class="ActionScriptDefault_Text">mycomponent</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">/</span> 2.0;
            
            <span class="ActionScriptComment">/* in Ivan&apos;s code it was like this:
            mycomponent.x = origin.x + _canvas.width / 2.0;
            mycomponent.y = origin.y + _canvas.height / 2.0;
            */</span>
            
            <span class="ActionScriptComment">/* add event handlers for dragging and double click */</span>            
            <span class="ActionScriptDefault_Text">mycomponent</span>.<span class="ActionScriptDefault_Text">doubleClickEnabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptDefault_Text">mycomponent</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">DOUBLE_CLICK</span>, <span class="ActionScriptDefault_Text">nodeDoubleClick</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">mycomponent</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_DOWN</span>,<span class="ActionScriptDefault_Text">nodeMouseDown</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">/* Optimize drag and drop, Only add event listener for mouse up if there is mouse move event. */</span>
            <span class="ActionScriptComment">//mycomponent.addEventListener(MouseEvent.MOUSE_UP, dragEnd);
</span>
            <span class="ActionScriptComment">/* enable bitmap cachine if required */</span>
            <span class="ActionScriptDefault_Text">mycomponent</span>.<span class="ActionScriptDefault_Text">cacheAsBitmap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cacheRendererObjects</span>;

            <span class="ActionScriptComment">/* add the component to its parent component */</span>
            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomponent</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* do we have an effect set for addition of
             * items? If yes, create and start it. */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">addItemEffect</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">addItemEffect</span>.<span class="ActionScriptDefault_Text">createInstance</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomponent</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">startEffect</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* register it the view in the vnode and the mapping */</span>
            <span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">view</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mycomponent</span>;
            <span class="ActionScriptDefault_Text">_viewToVNodeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">mycomponent</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn</span>;
            
            <span class="ActionScriptComment">/* increase the component counter */</span>
            <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_componentCounter</span>;
            
            <span class="ActionScriptComment">/* assertion there should not be more components than
             * visible nodes */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_componentCounter</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_noVisibleVNodes</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Got too many components:&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">_componentCounter</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot; but only:&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">_noVisibleVNodes</span>
                <span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot; nodes visible&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* we need to invalidate the display list since
             * we created new children */</span>
            <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mycomponent</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Remove a &quot;view&quot; object (UIComponent) for the given node and specify whether
         * this should honor any specified add/remove effects.
         * These methods are only exported to be used by
         * the VisualNode. Alas, AS does not provide the &quot;friend&quot; directive.
         * Not sure how to get around this problem right now.
         * @param component The UIComponent to be removed.
         * @param honorEffect To specify whether the effect should be applied or not.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>, <span class="ActionScriptDefault_Text">honorEffect</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            
            <span class="ActionScriptComment">/* if there is an effect, start the effect and register a
             * handler that actually calls this method again, but
             * with honorEffect set to false */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">honorEffect</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">removeItemEffect</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">removeItemEffect</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">EffectEvent</span>.<span class="ActionScriptDefault_Text">EFFECT_END</span>,
                                                   <span class="ActionScriptDefault_Text">removeEffectDone</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">removeItemEffect</span>.<span class="ActionScriptDefault_Text">createInstance</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">startEffect</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">/* remove the component from it&apos;s parent (which should be the canvas) */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span>.<span class="ActionScriptDefault_Text">parent</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">component</span>.<span class="ActionScriptDefault_Text">parent</span>.<span class="ActionScriptDefault_Text">removeChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">/* remove event mouse listeners */</span>
                <span class="ActionScriptDefault_Text">component</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">DOUBLE_CLICK</span>,<span class="ActionScriptDefault_Text">nodeDoubleClick</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">component</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_DOWN</span>,<span class="ActionScriptDefault_Text">nodeMouseDown</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">component</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_UP</span>, <span class="ActionScriptDefault_Text">dragEnd</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">/* get the associated VNode and remove the view from it
                 * and also remove the map entry */</span>
                <span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewToVNodeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">view</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_viewToVNodeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptComment">/* decreate component counter */</span>
                <span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">_componentCounter</span>;
                
                <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;removed component from node:&quot;+vn.id);
</span>            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Create a &quot;view&quot; object (UIComponent) for the given edge and
         * return it.
         * @param ve The edge to replace/add a view object.
         * @return The created view object.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createVEdgeView</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mycomponent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;

            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_edgeLabelRendererFactory</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mycomponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_edgeLabelRendererFactory</span>.<span class="ActionScriptDefault_Text">newInstance</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">/* this is only for the basic default */</span>
                <span class="ActionScriptDefault_Text">mycomponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Label</span>; <span class="ActionScriptComment">// this is our default label.
</span>                <span class="ActionScriptDefault_Text">mycomponent</span>.<span class="ActionScriptDefault_Text">setStyle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;textAlign&quot;</span>,<span class="ActionScriptString">&quot;center&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomponent</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Label</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">text</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">data</span>.@<span class="ActionScriptDefault_Text">association</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>            
                
            <span class="ActionScriptComment">/* assigns the edge to the IDataRenderer part of the view
             * this is important to access the data object of the VEdge
             * which contains information for rendering. */</span>        
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomponent</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">IDataRenderer</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomponent</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">IDataRenderer</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ve</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* enable bitmap cachine if required */</span>
            <span class="ActionScriptDefault_Text">mycomponent</span>.<span class="ActionScriptDefault_Text">cacheAsBitmap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cacheRendererObjects</span>;
            
            <span class="ActionScriptComment">/* add the component to its parent component
             * this can create problems, we have to see where we
             * check for all children
             * Add after the edges layer, but below all other elements such as nodes */</span>
            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">addChildAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomponent</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* register it the view in the vedge and the mapping */</span>
            <span class="ActionScriptComment">/*
            if(ve.labelView != null) {
                LogUtil.debug(_LOG, &quot;Edge:&quot;+ve.edge.id+&quot; has already view:&quot;+ve.labelView.toString()+&quot; will be overwritten&quot;);
            } else {
                LogUtil.debug(_LOG, &quot;Edge:&quot;+ve.edge.id+&quot; gets new view.&quot;);
            }
            */</span>
            <span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">labelView</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mycomponent</span>;
            <span class="ActionScriptDefault_Text">_viewToVEdgeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">mycomponent</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ve</span>;
            
            <span class="ActionScriptComment">/* set initial default x/y values, these should be in the middle of the
             * edge, but depending on the edge renderer. Thus we should ask
             * the edge renderer, where it wants to place the label. This would
             * be a new method for the edge renderer interface */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_edgeRenderer</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">setEdgeLabelCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_edgeRenderer</span>.<span class="ActionScriptDefault_Text">labelCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">))</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">setEdgeLabelCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">/</span> 2.0, <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">/</span> 2.0<span class="ActionScriptBracket/Brace">))</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* we need to invalidate the display list since
             * we created new children */</span>
            <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mycomponent</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Remove a &quot;view&quot; object (UIComponent) for the given edge.
         * @param component The UIComponent to be removed.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeVEdgeView</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            
            
            <span class="ActionScriptComment">/* remove the component from it&apos;s parent (which should be the canvas) */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span>.<span class="ActionScriptDefault_Text">parent</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">component</span>.<span class="ActionScriptDefault_Text">parent</span>.<span class="ActionScriptDefault_Text">removeChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptComment">/* get the associated VEdge and remove the view from it
             * and also remove the map entry */</span>
            <span class="ActionScriptDefault_Text">ve</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewToVEdgeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">labelView</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_viewToVEdgeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptBracket/Brace">]</span>;
                
            <span class="ActionScriptComment">/* decreate component counter */</span>
            <span class="ActionScriptComment">//--_componentCounter;
</span>            
            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;removed component from node:&quot;+vn.id);
</span>        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * Event handler for a removal node procedure. Calls
         * removeComponent with a flag to avoid doing the effect again.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeEffectDone</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">EffectEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mycomponent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">effectInstance</span>.<span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span>;
            <span class="ActionScriptComment">/* call remove component again, but specify to ignore the effect */</span>
            <span class="ActionScriptDefault_Text">removeComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomponent</span>, <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Event handler to work on double-click events.
         * Any double click also counts as a drop event to
         * the layouter. But primarily the double click
         * sets a new root node.
         * @param e The corresponding event.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">nodeDoubleClick</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">comp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            
            <span class="ActionScriptComment">/* get the view object that was klicked on (actually
             * the one that has the event handler registered, which
             * is the VNode&apos;s view */</span>
            <span class="ActionScriptDefault_Text">comp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">currentTarget</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* get the associated VNode */</span>
            <span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lookupNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">comp</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;double click!&quot;);
</span>            
            <span class="ActionScriptComment">/* Now we change the root node, we go through
             * our public setter method to get all associated
             * updates done. */</span>
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">currentRootVNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vnode</span>;
            
            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;currentVNode:&quot;+this.currentRootVNode.id);
</span>            
            <span class="ActionScriptComment">/* here we still want to implicitly redraw */</span>
            <span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * This is the event handler for a single click 
         * event. Currently does only one thing:
         * - Starts a drag operation of this node.
         * @param e The associated event.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">nodeMouseDown</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">dragBegin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Start a drag operation. This sets the drag node and
         * registeres a &apos;MouseMove&apos; event handler with the
         * VNode, so it can follow the mouse movement.
         * @param event The MouseEvent that was triggered by clicking on the node.
         * @see handleDrag()
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dragBegin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ecomponent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">evnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Point</span>;
            
            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;DragBegin was called...&quot;);
</span>            
            <span class="ActionScriptComment">/* if there is an animation in progress, we ignore
             * the drag attempt */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">animInProgress</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">info</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;Animation in progress, drag attempt ignored&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* make sure we get the right component */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">currentTarget</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptDefault_Text">ecomponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">currentTarget</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">/* get the associated VNode of the view */</span>
                <span class="ActionScriptDefault_Text">evnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewToVNodeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ecomponent</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptComment">/* stop propagation to prevent a concurrent backgroundDrag */</span>
                <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stopImmediatePropagation</span><span class="ActionScriptBracket/Brace">()</span>;
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">evnode</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">dragLockCenter</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// lockCenter is false, use the mouse coordinates at the point
</span>                        <span class="ActionScriptDefault_Text">pt</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">localToGlobal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">mouseX</span>, <span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">mouseY</span><span class="ActionScriptBracket/Brace">))</span>;
                    <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// lockCenter is true, ignore the mouse coordinates
</span>                        <span class="ActionScriptComment">// and use (0,0) instead as the point
</span>                        <span class="ActionScriptComment">//TODO: change to the components`s center instead
</span>                        <span class="ActionScriptDefault_Text">pt</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">localToGlobal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>0,0<span class="ActionScriptBracket/Brace">))</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
            
                    <span class="ActionScriptComment">/* Save the offset values in the map 
                     * so we can compute x and y correctly in case
                     * we use lockCenter */</span>
                    
                    <span class="ActionScriptComment">//_drag_x_offsetMap[ecomponent] = pt.x / scaleX - ecomponent.x;
</span>                    <span class="ActionScriptComment">//_drag_y_offsetMap[ecomponent] = pt.y / scaleY - ecomponent.y;
</span>                    <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ecomponent</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pt</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">x</span>;
                    <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ecomponent</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pt</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">y</span>;
                    

                    <span class="ActionScriptComment">/* now we would need to set the bounds
                     * rectangle in _drag_boundsMap, but this is
                     * currently not implemented *
                    _drag_boundsMap[ecomponent] = rectangle;
                     */</span>
                    
                    <span class="ActionScriptComment">/* Registeran eventListener with the component&apos;s stage that
                     * handles any mouse move. This wires the component
                     * to the mouse. On every mouse move, the event handler
                     * is called, which updates its coordinates.
                     * We need to save the drag component, since we have to 
                     * register the event handler with the stage, not the component
                     * itself. But from the stage we have no way to get back to
                     * the component or the VNode in case of the mouse move or 
                     * drop event. 
                     */</span>
                    <span class="ActionScriptDefault_Text">_dragComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ecomponent</span>;
                    <span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_MOVE</span>, <span class="ActionScriptDefault_Text">handleDrag</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_UP</span>,<span class="ActionScriptDefault_Text">dragEnd</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptComment">/* also register a drop event listener */</span>
                    <span class="ActionScriptComment">// ecomponent.stage.addEventListener(MouseEvent.MOUSE_UP, dragEnd);
</span>                    
                    <span class="ActionScriptComment">/* and inform the layouter about the dragEvent */</span>
                    <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">dragEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>, <span class="ActionScriptDefault_Text">evnode</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Event Component was not in the viewToVNode Map&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;MouseEvent target was no UIComponent&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Called everytime the mouse moves after the dragBegin() method has
         * been called.  Updates the position of the Component based on
         * the location of the mouse cursor.
         * @param event The MouseMove event that has been triggered.
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">handleDrag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">myvnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
            
            <span class="ActionScriptComment">//var bounds:Rectangle;
</span>            
            <span class="ActionScriptComment">/* we set our Component to be the saved
             * dragComponent, because we cannot access it
             * through the event. */</span>
            <span class="ActionScriptDefault_Text">sp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_dragComponent</span>;
            
            <span class="ActionScriptComment">/* Sometimes we get spurious events */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_dragComponent</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">info</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;received handleDrag event but _dragComponent is null, ignoring&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* bounds are not implemented:
            bounds = _drag_boundsMap[sp];
            */</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_moveNodeInDrag</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">/* update the coordinates with the current
                 * event&apos;s stage coordinates (i.e. current mouse position),
                 * modified by the lock-center offset */</span>
                <span class="ActionScriptComment">//sp.x = event.stageX / scaleX - _drag_x_offsetMap[sp];
</span>                <span class="ActionScriptComment">//sp.y = event.stageY / scaleY - _drag_y_offsetMap[sp];
</span>                <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stageX</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stageY</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;


                <span class="ActionScriptComment">/* bounds code, currently unused 
                if ( bounds != null ) {
                    if ( sp.x &lt; bounds.left ) {
                        sp.x = bounds.left;
                    } else if ( sp.x &gt; bounds.right ) {
                        sp.x = bounds.right;
                    }    
                    if ( sp.y &lt; bounds.top ) {
                        sp.y = bounds.top;    
                    } else if ( sp.y &gt; bounds.bottom ) {
                        sp.y = bounds.bottom;    
                    }
                }
                */</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* and inform the layouter about the dragEvent */</span>
            <span class="ActionScriptDefault_Text">myvnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewToVNodeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_dragComponent</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">dragContinue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>, <span class="ActionScriptDefault_Text">myvnode</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* make sure flashplayer does an update after the event */</span>
            <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">updateAfterEvent</span><span class="ActionScriptBracket/Brace">()</span>;            
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * This handles a background drag (i.e. scroll). The
         * event listener is usually registered with the canvas,
         * i.e. this object.
         * @param event The triggered event.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">backgroundDragBegin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
        
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mycomponent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
            <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">mpoint</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">globalMousePosition</span><span class="ActionScriptBracket/Brace">()</span>;
        
            <span class="ActionScriptComment">/* if there is an animation in progress, we ignore
             * the drag attempt */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">animInProgress</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">info</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;Animation in progress, drag attempt ignored&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* this should be the canvas, i.e. &quot;this&quot; */</span>
            <span class="ActionScriptComment">//mycomponent = (event.currentTarget as UIComponent);
</span>            <span class="ActionScriptDefault_Text">mycomponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* check for validity */</span>
            <span class="ActionScriptComment">/* not needed any more 
            if(mycomponent == null) {
                throw Error(&quot;Got backgroundDragBegin without UIComponent target!&quot;);
            }
            */</span>
            
            <span class="ActionScriptComment">/* set the progress flag and save the starting coordinates */</span>
            <span class="ActionScriptDefault_Text">_backgroundDragInProgress</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            
            <span class="ActionScriptDefault_Text">_dragCursorStartX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mpoint</span>.<span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">_dragCursorStartY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mpoint</span>.<span class="ActionScriptDefault_Text">y</span>;
            
            <span class="ActionScriptComment">/* register the backgroundDrag listener to react to
             * the mouse movements */</span>
            <span class="ActionScriptDefault_Text">mycomponent</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_MOVE</span>, <span class="ActionScriptDefault_Text">backgroundDragContinue</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* and inform the layouter about the dragEvent */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">bgDragEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* There is mouse move event so listen to mouse up event */</span>
            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_UP</span>,<span class="ActionScriptDefault_Text">dragEnd</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * This does the actual background drag by having
         * all UIComponents move to follow the mouse
         * @param event The triggered mouse move event.
         * */</span> 
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">backgroundDragContinue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">mpoint</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">globalMousePosition</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">deltaX</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">deltaY</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_scrollBackgroundInDrag</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">/* compute the movement offset of this move by
                 * subtracting the current mouse position from
                 * the last mouse position */</span>
                <span class="ActionScriptDefault_Text">deltaX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mpoint</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_dragCursorStartX</span>;
                <span class="ActionScriptDefault_Text">deltaY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mpoint</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_dragCursorStartY</span>;
             
                <span class="ActionScriptComment">//deltaX /= scaleX
</span>                <span class="ActionScriptComment">//deltaY /= scaleY
</span>                <span class="ActionScriptDefault_Text">deltaX</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">deltaY</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptComment">/* scroll all objects by this offset */</span>
                <span class="ActionScriptDefault_Text">scroll</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">deltaX</span>, <span class="ActionScriptDefault_Text">deltaY</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">/* and inform the layouter about the dragEvent */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">bgDragContinue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* reset the drag start point for the next step */</span>
            <span class="ActionScriptDefault_Text">_dragCursorStartX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mpoint</span>.<span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">_dragCursorStartY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mpoint</span>.<span class="ActionScriptDefault_Text">y</span>;
            
            <span class="ActionScriptComment">/* make sure edges are redrawn */</span>
            <span class="ActionScriptComment">//_drawingSurface.invalidateDisplayList();
</span>            <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>


        <span class="ActionScriptASDoc">/**
         * This method handles the drop event (usually MOUSE_UP).
         * It stops any dragging in progress (including background drag)
         * and unregisters the current dragged node.
         * @param event The triggered event.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dragEnd</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mycomp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">myback</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">myvnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;

            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_UP</span>,<span class="ActionScriptDefault_Text">dragEnd</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_backgroundDragInProgress</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptComment">/* if it was a background drag we stop it here */</span>
                <span class="ActionScriptDefault_Text">_backgroundDragInProgress</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                
                <span class="ActionScriptComment">/* get the background drag object, which is usually
                 * the canvasm so we just set it to this */</span>
                <span class="ActionScriptComment">//myback = (event.currentTarget as DisplayObject);
</span>                <span class="ActionScriptDefault_Text">myback</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">DisplayObject</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">/*
                if(myback == (this as DisplayObject)) {
                    LogUtil.debug(_LOG, &quot;we found ourselves as the background object GREAT&quot;);
                } else {
                    LogUtil.debug(_LOG, &quot;we got something else as the background, HMPF&quot;);
                }
                */</span>
                
                <span class="ActionScriptComment">/* no longer needed
                if(myback == null) {
                    /* this can happen if we let go of the button
                     * outside of the window *
                    LogUtil.debug(_LOG, &quot;dragEnd: background drop event target was no DisplayObject but &quot;+event.currentTarget.toString());
                }
                */</span>
                
                <span class="ActionScriptComment">/* unregister event handler */</span>                
                <span class="ActionScriptDefault_Text">myback</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_MOVE</span>,<span class="ActionScriptDefault_Text">backgroundDragContinue</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">// myback.removeEventListener(MouseEvent.MOUSE_MOVE,dragEnd);
</span>                
                <span class="ActionScriptComment">/* and inform the layouter about the dropEvent */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">bgDropEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptComment">/* if it was no background drag, the component
                 * is the saved dragComponent */</span>
                <span class="ActionScriptDefault_Text">mycomp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_dragComponent</span>;
                
                <span class="ActionScriptComment">/* But sometimes the dragComponent was already null, 
                 * in this case we have to ignore the thing. */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomp</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">info</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;dragEnd: received dragEnd but _dragComponent was null, ignoring&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">return</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">/* remove the event listeners */</span>
                <span class="ActionScriptComment">//mycomp.stage.removeEventListener(MouseEvent.MOUSE_DOWN, dragEnd);
</span>                <span class="ActionScriptComment">// HACK: I have to check the stage because there are eventual components not added to the display list
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomp</span>.<span class="ActionScriptDefault_Text">stage</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">mycomp</span>.<span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_MOVE</span>, <span class="ActionScriptDefault_Text">handleDrag</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">/* get the associated VNode to notify the layouter */</span>
                <span class="ActionScriptDefault_Text">myvnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewToVNodeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">mycomp</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">dropEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>, <span class="ActionScriptDefault_Text">myvnode</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptComment">/* reset the dragComponent */</span>
                <span class="ActionScriptDefault_Text">_dragComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* and stop propagation, as otherwise we could get the
             * event multiple times */</span>
             
            <span class="ActionScriptComment">/* it&apos;s no need stop this event with new implmentation */</span> 
            <span class="ActionScriptComment">//event.stopImmediatePropagation();            
</span>        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * return the current mouse position, used by 
         * certain drag&amp;drop issues
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">globalMousePosition</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Point</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">localToGlobal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mouseX</span>, <span class="ActionScriptDefault_Text">mouseY</span><span class="ActionScriptBracket/Brace">))</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** 
         * 1. saves the old nodeID hash object.
         * 2. sets the new _nodeIDsWithinDistanceLimit Object from the object
         *    provided (typically provided from the GTree of a Graph).
         * 3. updates the amount of nodes in that object, by linearly
         *    counting them. This may be optimized...
         * @param vnids Object containing a hash with all node id&apos;s currently within the distance limit.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setDistanceLimitedNodeIds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vnids</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">val</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">amount</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            
            <span class="ActionScriptComment">/* reset the amount */</span>
            <span class="ActionScriptDefault_Text">amount</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptComment">/* save the old hash */</span>
            <span class="ActionScriptDefault_Text">_prevNodeIDsWithinDistanceLimit</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_nodeIDsWithinDistanceLimit</span>;
            
            <span class="ActionScriptComment">/* set the new hash object */</span>
            <span class="ActionScriptDefault_Text">_nodeIDsWithinDistanceLimit</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
            
            <span class="ActionScriptComment">/* walk through the hash and build the distanceLimit hash */</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">vnids</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">vnode</span>;
                <span class="ActionScriptDefault_Text">_nodeIDsWithinDistanceLimit</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn</span>;
                
                <span class="ActionScriptComment">/* increase the amount */</span>
                <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">amount</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">/* count all entries in this hash */</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">vnids</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">amount</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">/* set the new amount */</span>
            <span class="ActionScriptDefault_Text">_noNodesWithinDistance</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">amount</span>;
            
            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;current visible nodeids:&quot;+_noNodesWithinDistance);
</span>        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * This needs to walk through all nodes in the graph, as some nodes
         * have become invisible and other have become visible. There may be
         * a better way to do this, when adjusting the visibility but it is
         * not that clear.
         * 
         * walk through the graph and the limitedGraph and
         * turn off visibility for those that are not listed in
         * both
         * beware that the limited graph has no VItems, so 
         * we don&apos;t really need it, we would rather need
         * an array of node ids....
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">updateVisibility</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">edges</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">treeparents</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vno</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">newVisibleNodes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">toInvisibleNodes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;
            
            <span class="ActionScriptComment">/* since a layouter that uses timer based iterations
             * might find itself on a changing node set, we need
             * to stop/reset anything before altering the node
             * visibility */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">resetAll</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            
            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;update node visibility&quot;);
</span>            
            <span class="ActionScriptComment">/* create a copy of the currently visible 
             * node set, as the set for nodes to potentially
             * turned invisible */</span>
            <span class="ActionScriptDefault_Text">toInvisibleNodes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_visibleVNodes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">toInvisibleNodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* now populate the set of nodes which should be
             * turned visible, first by using the nodes  within
             * distance limit */</span>
            <span class="ActionScriptDefault_Text">newVisibleNodes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_nodeIDsWithinDistanceLimit</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">newVisibleNodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* now add the history nodes to the set of new visible
             * nodes if the history is enabled */</span>
            <span class="ActionScriptComment">/* Step 3: render all (new?) history nodes and nodes on the path visible (if applicable) */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_showCurrentNodeHistory</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        
                <span class="ActionScriptComment">/* this is mapping in the tree that provides a parent
                 * for each single node in the tree 
                 * we need this to find the trace to the root */</span>
                <span class="ActionScriptDefault_Text">treeparents</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">getTree</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_currentRootVNode</span>.<span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">parents</span>;
                
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_currentVNodeHistory</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">node</span>;        
                    <span class="ActionScriptComment">/* we cannot use vn here, because it is n that is changed
                     * in this while loop. Basically we are walking the tree
                     * backward from the current vnode&apos;s node n to the root
                     * for every vn in the history */</span>
                    <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_currentRootVNode</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        
                        <span class="ActionScriptComment">/* set it visible */</span>
                        <span class="ActionScriptDefault_Text">newVisibleNodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">vnode</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">vnode</span>;
                        <span class="ActionScriptComment">//setNodeVisibility(n.vnode, true);
</span>                        
                        <span class="ActionScriptComment">/* move to the parent node */</span>
                        <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">treeparents</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">]</span>;
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;parent node was null but node was not root node&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* now from each set remove the common nodes, these
             * are the nodes that should remain visible, so they
             * must not be turned invisible and should also not
             * be turned visible again. */</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">toInvisibleNodes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">newVisibleNodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">/* this is a common node, remove it from
                     * both dictionaries 
                     */</span>
                    <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">toInvisibleNodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">newVisibleNodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptBracket/Brace">}</span> 
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* now finally turn all toInvisibleNodes invisible
             * likewise any edge adjacent to an invisible node
             * will become invisible */</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">toInvisibleNodes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setNodeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span>, <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* and all new visible nodes to visible */</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">newVisibleNodes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setNodeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span>, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* and now walk again to update the edges */</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">toInvisibleNodes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">updateConnectedEdgesVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* and all new visible nodes to visible */</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">newVisibleNodes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">updateConnectedEdgesVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* send an event */</span>
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">VGraphEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VGraphEvent</span>.<span class="ActionScriptDefault_Text">VISIBILITY_CHANGED</span><span class="ActionScriptBracket/Brace">))</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * This methods walks through all nodes and updates
         * the edge visibility (only the edge visibility)
         * taking into account three factors:
         * visibility of adjacent nodes and
         * if we want edge labels or not at all
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">updateEdgeVisibility</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_visibleVNodes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">updateConnectedEdgesVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Reset visibility of all nodes, all nodes are back to visible.
         * This can be a very very heavy operation if you have many nodes. 
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setAllVisible</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span>;
            
            <span class="ActionScriptComment">/* not sure if this is really, really needed, but
             * since similar code was added, I optimise it a bit.
             */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;setAllVisible() called, but graph is null&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* since a layouter that uses timer based iterations
             * might find itself on a changing node set, we need
             * to stop/reset anything before altering the node
             * visibility */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">resetAll</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* recreate those, this is cheaper probably */</span>
            <span class="ActionScriptDefault_Text">_visibleVNodes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
            <span class="ActionScriptDefault_Text">_noVisibleVNodes</span> <span class="ActionScriptOperator">=</span> 0;
        
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">nodes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setNodeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">vnode</span>, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
                
            <span class="ActionScriptComment">/* same for edges */</span>
            <span class="ActionScriptDefault_Text">_visibleVEdges</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">edges</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setEdgeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">vedge</span>, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Reset visibility of all nodes, all nodes are INVISIBLE.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setAllInVisible</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            
            <span class="ActionScriptComment">/* not sure if this is really, really needed, but
             * since similar code was added, I optimise it a bit.
             */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;setAllInVisible() called, but graph is null&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* since a layouter that uses timer based iterations
             * might find itself on a changing node set, we need
             * to stop/reset anything before altering the node
             * visibility */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">resetAll</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_visibleVNodes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setNodeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span>, <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_visibleVEdges</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setEdgeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span>, <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    
        <span class="ActionScriptASDoc">/**
         * Reset visibility of all edges to INVISIBLE.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setAllEdgesInVisible</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_visibleVEdges</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setEdgeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span>, <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>    
    
        <span class="ActionScriptASDoc">/**
         * This sets a VNode visible or invisible, updating all related
         * data.
         * @param vn The VisualNode to be turned invisible or not.
         * @param visible The indicator if visible or not.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setNodeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>, <span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">comp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
            
            <span class="ActionScriptComment">/* was there actually a change, if not issue a warning */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">isVisible</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;Tried to set node:&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot; visibility to:&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">visible</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot; but it was already.&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptComment">/* set the node to visible, this might create a view for it */</span>
                <span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">isVisible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptComment">/* add it to the hash of currently visible nodes */</span>
                <span class="ActionScriptDefault_Text">_visibleVNodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn</span>;
                <span class="ActionScriptComment">/* increase the counter */</span>
                <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">_noVisibleVNodes</span>;
                
                <span class="ActionScriptComment">/* create the node&apos;s view */</span>
                <span class="ActionScriptDefault_Text">comp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createVNodeComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">/* set it to visible, should be default anyway */</span>
                <span class="ActionScriptDefault_Text">comp</span>.<span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptComment">// i.e. set to invisible 
</span>                <span class="ActionScriptComment">/* render node invisible, thus potentially destroying its view */</span>
                <span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">isVisible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptComment">/* remove it from the hash */</span>
                <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_visibleVNodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptComment">/* decrease the counter */</span>
                <span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">_noVisibleVNodes</span>;
                
                <span class="ActionScriptComment">/* remove the view if there is one */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">view</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">removeComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">view</span>, <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * This sets a VEdge visible or invisible, updating all related
         * data.
         * @param ve The VisualEdge to be turned invisible or not.
         * @param visible The indicator if visible or not.
         * */</span>    
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setEdgeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>, <span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">comp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
            
            <span class="ActionScriptComment">/* was there actually a change, if not issue a warning */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">isVisible</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//LogUtil.warn(_LOG, &quot;Tried to set vedge:&quot;+ve.id+&quot; visibility to:&quot;+visible.toString()+&quot; but it was already.&quot;);
</span>                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptComment">/* add it to the hash of currently visible nodes */</span>
                <span class="ActionScriptDefault_Text">_visibleVEdges</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ve</span>;
                
                <span class="ActionScriptComment">/* check if there is no view and we need one */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_displayEdgeLabels</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">labelView</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">comp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createVEdgeView</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">/* set the edges view to visible */</span>
                <span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">isVisible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptComment">// i.e. set to invisible 
</span>                <span class="ActionScriptComment">/* render node invisible, thus potentially destroying its view */</span>
                <span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">isVisible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptComment">/* remove it from the hash */</span>
                <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_visibleVEdges</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptComment">/* remove the view if there is one */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">labelView</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">removeVEdgeView</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">labelView</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * This methods walks through all edges connected
         * to a node and sets them either visible or invisible
         * depending on the visibility of the given node and
         * the node on the other end. An edge is only visible
         * if both nodes are visible.
         * @param vn The VisualNode of which connected edges should be updated.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">updateConnectedEdgesVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">edges</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ovn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span>;
            
            <span class="ActionScriptComment">/* now here we have to test each edges othernode
             * if it is also visible */</span>
            <span class="ActionScriptDefault_Text">edges</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">inEdges</span>;
            
            <span class="ActionScriptComment">/* concat might lead to duplication in the case of
             * undirected graphs... :( not sure how to efficiently
             * only add items which are not there, yet?
             */</span>
            <span class="ActionScriptDefault_Text">edges</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">edges</span>.<span class="ActionScriptDefault_Text">concat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">outEdges</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">edges</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptComment">/* get the other node at the end of the edge */</span>
                <span class="ActionScriptDefault_Text">ovn</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">othernode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">vnode</span>;
                    
                <span class="ActionScriptComment">/* if this node either is still visible or in the
                 * list to become visible, then the edge is also
                 * visible */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">isVisible</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">ovn</span>.<span class="ActionScriptDefault_Text">isVisible</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">setEdgeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">vedge</span>,<span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">setEdgeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">vedge</span>,<span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
