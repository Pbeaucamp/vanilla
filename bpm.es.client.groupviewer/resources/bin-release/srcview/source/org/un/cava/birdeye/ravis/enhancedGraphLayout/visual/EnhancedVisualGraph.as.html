<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>EnhancedVisualGraph.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">enhancedGraphLayout</span>.<span class="ActionScriptDefault_Text">visual</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">display</span>.<span class="ActionScriptDefault_Text">DisplayObject</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">MouseEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">Point</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">Dictionary</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">collections</span>.<span class="ActionScriptDefault_Text">ArrayCollection</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">IDataRenderer</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">IFactory</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">UIComponent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">ObjectUtil</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">enhancedGraphLayout</span>.<span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">VGEdgeEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">enhancedGraphLayout</span>.<span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">VGNodeEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">enhancedGraphLayout</span>.<span class="ActionScriptDefault_Text">visual</span>.<span class="ActionScriptDefault_Text">edgeRenderers</span>.<span class="ActionScriptDefault_Text">EdgeControlRenderer</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">enhancedGraphLayout</span>.<span class="ActionScriptDefault_Text">visual</span>.<span class="ActionScriptDefault_Text">edgeRenderers</span>.<span class="ActionScriptDefault_Text">EdgeRenderer</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">graphLayout</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">IEdge</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">graphLayout</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">INode</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">graphLayout</span>.<span class="ActionScriptDefault_Text">layout</span>.<span class="ActionScriptDefault_Text">HierarchicalLayouter</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">graphLayout</span>.<span class="ActionScriptDefault_Text">visual</span>.<span class="ActionScriptDefault_Text">IVisualEdge</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">graphLayout</span>.<span class="ActionScriptDefault_Text">visual</span>.<span class="ActionScriptDefault_Text">IVisualNode</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">graphLayout</span>.<span class="ActionScriptDefault_Text">visual</span>.<span class="ActionScriptDefault_Text">VisualGraph</span>;
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">EnhancedVisualGraph</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">VisualGraph</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_viewToVEdgeRendererMap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_enableDefaultDoubleClick</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_enableDragNodeWithSubTree</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        
        <span class="ActionScriptASDoc">/**
         * This is the current Edge Control component that is dragged by the mouse.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_dragControlComponent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
        
        
        <span class="ActionScriptASDoc">/**
         * Also allow the specification of an IFactory for edge
         * controls.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_edgeControlRendererFactory</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IFactory</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;

        <span class="ActionScriptASDoc">/**
         * Specify whether edge labels should be displayed or not
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_displayEdgeControls</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        
 
         <span class="ActionScriptASDoc">/**
         * Also allow the specification of an IFactory for node
         * labels.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_nodeLabelRendererFactory</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IFactory</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
        
        <span class="ActionScriptASDoc">/**
         * Flag to force a redraw of all node even if the layout
         * has not changed
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_forceUpdateNodes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        
        <span class="ActionScriptASDoc">/**
         * Specify whether node labels should be displayed or not
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_displayNodeLabels</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">EnhancedVisualGraph</span><span class="ActionScriptBracket/Brace">()</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">_viewToVEdgeRendererMap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">edgeControlRenderer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ecr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IFactory</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">/* if the factory was changed, then we have to remove all
             * instances of vedgeViews to have them updated */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ecr</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_edgeLabelRendererFactory</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">/* set all edges invisible, this should delete all instances
                 * of view components */</span>
                <span class="ActionScriptDefault_Text">setAllEdgesInVisible</span><span class="ActionScriptBracket/Brace">()</span>;
            
                <span class="ActionScriptComment">/* set the new renderer */</span>
                <span class="ActionScriptDefault_Text">_edgeControlRendererFactory</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ecr</span>;    
                
                <span class="ActionScriptComment">/* update i.e. recreate the instances */</span>
                <span class="ActionScriptDefault_Text">updateEdgeVisibility</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">edgeControlRenderer</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IFactory</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_edgeControlRendererFactory</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">nodeLabelRenderer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">elr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IFactory</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">/* if the factory was changed, then we have to remove all
             * instances of vedgeViews to have them updated */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">elr</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_nodeLabelRendererFactory</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">/* set all edges invisible, this should delete all instances
                 * of view components */</span>
                <span class="ActionScriptDefault_Text">setAllInVisible</span><span class="ActionScriptBracket/Brace">()</span>;
            
                <span class="ActionScriptComment">/* set the new renderer */</span>
                <span class="ActionScriptDefault_Text">_nodeLabelRendererFactory</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">elr</span>;    
                
                <span class="ActionScriptComment">/* update i.e. recreate the instances */</span>
                <span class="ActionScriptDefault_Text">updateVisibility</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
            
        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">nodeLabelRenderer</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IFactory</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_nodeLabelRendererFactory</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">displayEdgeControls</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dec</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_displayEdgeControls</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">dec</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// no change
</span>            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_displayEdgeControls</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dec</span>;
                <span class="ActionScriptDefault_Text">setAllEdgesInVisible</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptComment">//_canvas.invalidateDisplayList(); // maybe this is enough
</span>                <span class="ActionScriptDefault_Text">updateEdgeVisibility</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">displayEdgeControls</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_displayEdgeControls</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">displayNodeLabels</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">del</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_displayNodeLabels</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">del</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// no change
</span>            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_displayNodeLabels</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">del</span>;
                <span class="ActionScriptDefault_Text">setAllInVisible</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptComment">//_canvas.invalidateDisplayList(); // maybe this is enough
</span>                <span class="ActionScriptDefault_Text">updateVisibility</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">displayNodeLabels</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_displayNodeLabels</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">moveGraphInDrag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">f</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_moveGraphInDrag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">f</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">moveEdgeInDrag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">f</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_moveEdgeInDrag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">f</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * This calls the base updateDisplayList() method of the
         * Canvas and in addition redraws all edges if the layouter
         * indicates that the layout has changed.
         * 
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">updateDisplayList</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unscaledWidth</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">unscaledHeight</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">/* call the original function */</span>
            <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">updateDisplayList</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unscaledWidth</span>,<span class="ActionScriptDefault_Text">unscaledHeight</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">/* now add part to redraw edges */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_forceUpdateNodes</span><span class="ActionScriptBracket/Brace">)</span>  <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_forceUpdateNodes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Creates VNode and requires a Graph node to associate
         * it with. Originally also created the view, but we no
         * longer do that directly but only on demand.
         * @param n The graph node to be associated with.
         * @return The created VisualNode.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createVNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            
            <span class="ActionScriptComment">/* as an id we use the id of the graph node for simplicity
             * for now, it is not really used separately anywhere
             * we also use the graph data object as our data object.
             * the view is set to null and remains so. */</span>
            <span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">EnhancedVisualNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>, <span class="ActionScriptDefault_Text">n</span>, <span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">id</span>, <span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* if the node should be visible by default 
             * we need to make sure that the view is created */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">newNodesDefaultVisible</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setNodeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vnode</span>, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptComment">/* now set the vnode in the node */</span>
            <span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vnode</span>;
            
            <span class="ActionScriptComment">/* add the node to the hash to keep track */</span>
            <span class="ActionScriptDefault_Text">_vnodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vnode</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vnode</span>;
            
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">vnode</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>, <span class="ActionScriptDefault_Text">honorEffect</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            
            <span class="ActionScriptComment">/* if there is an effect, start the effect and register a
             * handler that actually calls this method again, but
             * with honorEffect set to false */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">honorEffect</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">removeItemEffect</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">removeComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span>, <span class="ActionScriptDefault_Text">honorEffect</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewToVNodeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">removeComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span>, <span class="ActionScriptDefault_Text">honorEffect</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">labelView</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IEnhancedVisualNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">labelView</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">labelView</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">labelView</span>.<span class="ActionScriptDefault_Text">parent</span><span class="ActionScriptBracket/Brace">){</span>
                    <span class="ActionScriptDefault_Text">labelView</span>.<span class="ActionScriptDefault_Text">parent</span>.<span class="ActionScriptDefault_Text">removeChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">labelView</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Removes a VNode, this also removes the node&apos;s view
         * if it existed, but does not touch the Graph node.
         * @param vn The VisualNode to be removed.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeVNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">IEnhancedVisualNode</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">labelView</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
                <span class="ActionScriptDefault_Text">labelView</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">IEnhancedVisualNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">labelView</span>;
            
                <span class="ActionScriptDefault_Text">IEnhancedVisualNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">labelView</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">labelView</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">labelView</span>.<span class="ActionScriptDefault_Text">parent</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">labelView</span>.<span class="ActionScriptDefault_Text">parent</span>.<span class="ActionScriptDefault_Text">removeChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">labelView</span><span class="ActionScriptBracket/Brace">)</span>;    
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">removeVNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">)</span>;            
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Creates a VEdge from a graph Edge.
         * @param e The Graph Edge.
         * @return The created VEdge.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createVEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vedge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lStyle</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">edgeAttrs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XMLList</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">attr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">attname</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">attrs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
        
            <span class="ActionScriptComment">/* create a copy of the default style */</span>
            <span class="ActionScriptDefault_Text">lStyle</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ObjectUtil</span>.<span class="ActionScriptDefault_Text">copy</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_defaultEdgeStyle</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* extract style data from associated XML data for each parameter */</span>
            <span class="ActionScriptDefault_Text">attrs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ObjectUtil</span>.<span class="ActionScriptDefault_Text">getClassInfo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lStyle</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">properties</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">attname</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">attrs</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">attribute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">attname</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">lStyle</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">attname</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span>.@<span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">attname</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">attname</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">attrs</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">hasOwnProperty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">attname</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">lStyle</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">attname</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">attname</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">vedge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">EnhancedVisualEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>, <span class="ActionScriptDefault_Text">e</span>, <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">id</span>, <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span>, <span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">lStyle</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* set the VisualEdge reference in the graph edge */</span>
            <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">vedge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vedge</span>;
            
            <span class="ActionScriptComment">/* check if the edge is supposed to be visible */</span>
            <span class="ActionScriptDefault_Text">n1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">node1</span>;
            <span class="ActionScriptDefault_Text">n2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">node2</span>;
            
            <span class="ActionScriptComment">/* if both nodes are visible, the edge should
             * be made visible, which may also create a label
             */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n1</span>.<span class="ActionScriptDefault_Text">vnode</span>.<span class="ActionScriptDefault_Text">isVisible</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">n2</span>.<span class="ActionScriptDefault_Text">vnode</span>.<span class="ActionScriptDefault_Text">isVisible</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setEdgeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vedge</span>, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* add to tracking hash */</span>
            <span class="ActionScriptDefault_Text">_vedges</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vedge</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vedge</span>;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">vedge</span>;
        <span class="ActionScriptBracket/Brace">}</span>


        <span class="ActionScriptASDoc">/**
         * Create a &quot;view&quot; object (UIComponent) for the given node and
         * return it. These methods are only exported to be used by
         * the VisualNode. Alas, AS does not provide the &quot;friend&quot; directive.
         * Not sure how to get around this problem right now.
         * @param vn The node to replace/add a view object.
         * @return The created view object.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createVNodeComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptBracket/Brace">{</span>
    
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mycomponent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mylabelcomponent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                        <span class="ActionScriptComment">/////////////////////////////////////////////////////
</span>            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">_nodeLabelRendererFactory</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">IEnhancedVisualNode</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_edgeRenderer</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">IControllableEdgeRenderer</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mylabelcomponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_nodeLabelRendererFactory</span>.<span class="ActionScriptDefault_Text">newInstance</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptComment">/* assigns the edge to the IDataRenderer part of the view
                 * this is important to access the data object of the VEdge
                 * which contains information for rendering. */</span>        
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mylabelcomponent</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">IDataRenderer</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mylabelcomponent</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">IDataRenderer</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">mylabelcomponent</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">/</span> 2.0;
                <span class="ActionScriptDefault_Text">mylabelcomponent</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">/</span> 2.0;
            
                <span class="ActionScriptComment">/* enable bitmap cachine if required */</span>
                <span class="ActionScriptDefault_Text">mylabelcomponent</span>.<span class="ActionScriptDefault_Text">cacheAsBitmap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cacheRendererObjects</span>;
                <span class="ActionScriptComment">/* add the component to its parent component
                 * this can create problems, we have to see where we
                 * check for all children
                 * Add after the edges layer, but below all other elements such as nodes */</span>
                <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">addChildAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mylabelcomponent</span>, 0<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">IEnhancedVisualNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">labelView</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mylabelcomponent</span>;
            <span class="ActionScriptBracket/Brace">}</span>    
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">createVNodeComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Create a &quot;view&quot; object (UIComponent) for the given edge and
         * return it.
         * @param ve The edge to replace/add a view object.
         * @return The created view object.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createVEdgeView</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mycomponent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">createVEdgeView</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_edgeLabelRendererFactory</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fromControl</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">toControl</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">_edgeControlRendererFactory</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">IControlableVisualEdge</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">fromControl</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_edgeControlRendererFactory</span>.<span class="ActionScriptDefault_Text">newInstance</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptDefault_Text">fromControl</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;type&apos;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">EdgeControlRenderer</span>.<span class="ActionScriptDefault_Text">FROM_CONTROL</span>;
                    <span class="ActionScriptDefault_Text">toControl</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_edgeControlRendererFactory</span>.<span class="ActionScriptDefault_Text">newInstance</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptDefault_Text">toControl</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;type&apos;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">EdgeControlRenderer</span>.<span class="ActionScriptDefault_Text">TO_CONTROL</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">toControl</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">IDataRenderer</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fromControl</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">IDataRenderer</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ve</span>;
                        <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">toControl</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">IDataRenderer</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ve</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">fromControl</span>.<span class="ActionScriptDefault_Text">cacheAsBitmap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cacheRendererObjects</span>;
                    <span class="ActionScriptDefault_Text">toControl</span>.<span class="ActionScriptDefault_Text">cacheAsBitmap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cacheRendererObjects</span>;
                    <span class="ActionScriptDefault_Text">IControlableVisualEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">fromControl</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fromControl</span>;
                    <span class="ActionScriptDefault_Text">IControlableVisualEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">toControl</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toControl</span>;
                    <span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomponent</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">fromControl</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fromControl</span>;
                    <span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomponent</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">toControl</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toControl</span>;
                    <span class="ActionScriptDefault_Text">fromControl</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_DOWN</span>, <span class="ActionScriptDefault_Text">edgeMouseDown</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">toControl</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_DOWN</span>, <span class="ActionScriptDefault_Text">edgeMouseDown</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_viewToVEdgeRendererMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">fromControl</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mycomponent</span>;
                    <span class="ActionScriptDefault_Text">_viewToVEdgeRendererMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">toControl</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mycomponent</span>;
                    
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_edgeRenderer</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">IControlableVisualEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">setEdgeFromControlCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">IControllableEdgeRenderer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_edgeRenderer</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">fromControlCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">))</span>;
                        <span class="ActionScriptDefault_Text">IControlableVisualEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">setEdgeToControlCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">IControllableEdgeRenderer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_edgeRenderer</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">toControlCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">))</span>;
                    <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">IControlableVisualEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">setEdgeFromControlCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">/</span> 2.0, <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">/</span> 2.0<span class="ActionScriptBracket/Brace">))</span>;
                        <span class="ActionScriptDefault_Text">IControlableVisualEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">setEdgeToControlCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">/</span> 2.0, <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">/</span> 2.0<span class="ActionScriptBracket/Brace">))</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mycomponent</span>;
        <span class="ActionScriptBracket/Brace">}</span>        

        <span class="ActionScriptASDoc">/**
         * Remove a &quot;view&quot; object (UIComponent) for the given edge.
         * @param component The UIComponent to be removed.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeVEdgeView</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptComment">/* remove the  control component from it&apos;s parent (which should be the canvas) */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span>.<span class="ActionScriptDefault_Text">parent</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">EdgeRenderer</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fromControl</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">EdgeRenderer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">fromControl</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fromControl</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">fromControl</span>.<span class="ActionScriptDefault_Text">parent</span>.<span class="ActionScriptDefault_Text">removeChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fromControl</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_viewToVEdgeRendererMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">fromControl</span><span class="ActionScriptBracket/Brace">]</span>;
                        
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">toControl</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">EdgeRenderer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">toControl</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">toControl</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">toControl</span>.<span class="ActionScriptDefault_Text">parent</span>.<span class="ActionScriptDefault_Text">removeChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">toControl</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_viewToVEdgeRendererMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">toControl</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">removeVEdgeView</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">component</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">edgeMouseDown</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">dragControlBegin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * Start a drag operation. This sets the drag node and
         * registeres a &apos;MouseMove&apos; event handler with the
         * VNode, so it can follow the mouse movement.
         * @param event The MouseEvent that was triggered by clicking on the node.
         * @see handleDrag()
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dragBegin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ecomponent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">evnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">node</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Point</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_moveNodeInDrag</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span>;
                
            <span class="ActionScriptComment">//trace(&quot;DragBegin was called...&quot;);
</span>            
            <span class="ActionScriptComment">/* if there is an animation in progress, we ignore
             * the drag attempt */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">animInProgress</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Animation in progress, drag attempt ignored&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* make sure we get the right component */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">currentTarget</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptDefault_Text">ecomponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">currentTarget</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">/* get the associated VNode of the view */</span>
                <span class="ActionScriptDefault_Text">evnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewToVNodeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ecomponent</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptComment">/* stop propagation to prevent a concurrent backgroundDrag */</span>
                <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stopImmediatePropagation</span><span class="ActionScriptBracket/Brace">()</span>;
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">evnode</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">node</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">evnode</span>.<span class="ActionScriptDefault_Text">node</span>;
                    
                    <span class="ActionScriptComment">/* if (ElectricalGraph.isConnected(node) == false)
                    {
                        var dragSource:DragSource = new DragSource();
                        dragSource.addData(node, &apos;node&apos;);
                        DragManager.doDrag(ecomponent, dragSource, event);
                        return;
                    } */</span>
                    
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">dragLockCenter</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// lockCenter is false, use the mouse coordinates at the point
</span>                        <span class="ActionScriptDefault_Text">pt</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">localToGlobal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">mouseX</span>, <span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">mouseY</span><span class="ActionScriptBracket/Brace">))</span>;
                    <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// lockCenter is true, ignore the mouse coordinates
</span>                        <span class="ActionScriptComment">// and use (0,0) instead as the point
</span>                        <span class="ActionScriptComment">//TODO: change to the components`s center instead
</span>                        <span class="ActionScriptDefault_Text">pt</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">localToGlobal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>0,0<span class="ActionScriptBracket/Brace">))</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
            
                    <span class="ActionScriptComment">/* Save the offset values in the map 
                     * so we can compute x and y correctly in case
                     * we use lockCenter */</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nodeComponent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">enode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">evnode</span>.<span class="ActionScriptDefault_Text">node</span>;
                    
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">arrTreeNodes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ArrayCollection</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">arrTreeRoots</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">enode</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
                    
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_enableDragNodeWithSubTree</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrTreeNodes</span>.<span class="ActionScriptDefault_Text">contains</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">arrTreeNodes</span>.<span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptBracket/Brace">)</span>;
                                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nextTreeRoot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">curTreeRoot</span>.<span class="ActionScriptDefault_Text">successors</span><span class="ActionScriptBracket/Brace">)</span>
                                    <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nextTreeRoot</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptDefault_Text">curTreeRoot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">arrTreeNodes</span>.<span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">enode</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">movedNode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">arrTreeNodes</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">nodeComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">movedNode</span>.<span class="ActionScriptDefault_Text">vnode</span>.<span class="ActionScriptDefault_Text">view</span>;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nodeComponent</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">nodeComponent</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pt</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">nodeComponent</span>.<span class="ActionScriptDefault_Text">x</span>;
                            <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">nodeComponent</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pt</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">nodeComponent</span>.<span class="ActionScriptDefault_Text">y</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    
                    <span class="ActionScriptComment">//_drag_x_offsetMap[ecomponent] = pt.x / (scaleX*_canvas.scaleX) - ecomponent.x;
</span>                    <span class="ActionScriptComment">//_drag_y_offsetMap[ecomponent] = pt.y / (scaleY*_canvas.scaleY) - ecomponent.y;
</span>            
                    <span class="ActionScriptComment">/* now we would need to set the bounds
                     * rectangle in _drag_boundsMap, but this is
                     * currently not implemented *
                    _drag_boundsMap[ecomponent] = rectangle;
                     */</span>
                    
                    <span class="ActionScriptComment">/* Registeran eventListener with the component&apos;s stage that
                     * handles any mouse move. This wires the component
                     * to the mouse. On every mouse move, the event handler
                     * is called, which updates its coordinates.
                     * We need to save the drag component, since we have to 
                     * register the event handler with the stage, not the component
                     * itself. But from the stage we have no way to get back to
                     * the component or the VNode in case of the mouse move or 
                     * drop event. 
                     */</span>
                    <span class="ActionScriptDefault_Text">_dragComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ecomponent</span>;
                    <span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_MOVE</span>, <span class="ActionScriptDefault_Text">handleDrag</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_UP</span>,<span class="ActionScriptDefault_Text">dragEnd</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptComment">/* also register a drop event listener */</span>
                    <span class="ActionScriptComment">// ecomponent.stage.addEventListener(MouseEvent.MOUSE_UP, dragEnd);
</span>                    
                    <span class="ActionScriptComment">/* and inform the layouter about the dragEvent */</span>
                    <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">dragEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>, <span class="ActionScriptDefault_Text">evnode</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Event Component was not in the viewToVNode Map&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;MouseEvent target was no UIComponent&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dragControlBegin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ecomponent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">evedge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Point</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_moveEdgeInDrag</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span>;
                
            <span class="ActionScriptComment">//trace(&quot;DragBegin was called...&quot;);
</span>            
            <span class="ActionScriptComment">/* if there is an animation in progress, we ignore
             * the drag attempt */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">animInProgress</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Animation in progress, drag attempt ignored&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* make sure we get the right component */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">currentTarget</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptDefault_Text">ecomponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">currentTarget</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">/* stop propagation to prevent a concurrent backgroundDrag */</span>
                <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stopImmediatePropagation</span><span class="ActionScriptBracket/Brace">()</span>;
                
                <span class="ActionScriptDefault_Text">pt</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">localToGlobal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>0,0<span class="ActionScriptBracket/Brace">))</span>;
        
                <span class="ActionScriptComment">/* Save the offset values in the map 
                 * so we can compute x and y correctly in case
                 * we use lockCenter */</span>
                <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ecomponent</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pt</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ecomponent</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pt</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">y</span>;
                
                <span class="ActionScriptComment">/* now we would need to set the bounds
                 * rectangle in _drag_boundsMap, but this is
                 * currently not implemented *
                _drag_boundsMap[ecomponent] = rectangle;
                 */</span>
                
                <span class="ActionScriptComment">/* Registeran eventListener with the component&apos;s stage that
                 * handles any mouse move. This wires the component
                 * to the mouse. On every mouse move, the event handler
                 * is called, which updates its coordinates.
                 * We need to save the drag component, since we have to 
                 * register the event handler with the stage, not the component
                 * itself. But from the stage we have no way to get back to
                 * the component or the VNode in case of the mouse move or 
                 * drop event. 
                 */</span>
                <span class="ActionScriptDefault_Text">_dragControlComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ecomponent</span>;
                <span class="ActionScriptDefault_Text">ecomponent</span>.<span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_MOVE</span>, <span class="ActionScriptDefault_Text">handleDragControl</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_UP</span>,<span class="ActionScriptDefault_Text">dragControlEnd</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">/* also register a drop event listener */</span>
                <span class="ActionScriptComment">// ecomponent.stage.addEventListener(MouseEvent.MOUSE_UP, dragEnd);
</span>            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;MouseEvent target was no UIComponent&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Called everytime the mouse moves after the dragBegin() method has
         * been called.  Updates the position of the Component based on
         * the location of the mouse cursor.
         * @param event The MouseMove event that has been triggered.
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">handleDrag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">myvnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_moveNodeInDrag</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_moveGraphInDrag</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//this.parent.dispatchEvent(event);
</span>                <span class="ActionScriptBracket/Brace">}</span>    
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">//var bounds:Rectangle;
</span>            
            <span class="ActionScriptComment">/* we set our Component to be the saved
             * dragComponent, because we cannot access it
             * through the event. */</span>
            <span class="ActionScriptDefault_Text">sp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_dragComponent</span>;
            
            <span class="ActionScriptComment">/* Sometimes we get spurious events */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_dragComponent</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;received handleDrag event but _dragComponent is null, ignoring&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* bounds are not implemented:
            bounds = _drag_boundsMap[sp];
            */</span>
            
            <span class="ActionScriptComment">/* update the coordinates with the current
             * event&apos;s stage coordinates (i.e. current mouse position),
             * modified by the lock-center offset */</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ptrObj</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">sp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span>;
                <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stageX</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;    
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">sp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span>;
                <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stageY</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            
            <span class="ActionScriptComment">/* bounds code, currently unused 
            if ( bounds != null ) {
                if ( sp.x &lt; bounds.left ) {
                    sp.x = bounds.left;
                } else if ( sp.x &gt; bounds.right ) {
                    sp.x = bounds.right;
                }    
                if ( sp.y &lt; bounds.top ) {
                    sp.y = bounds.top;    
                } else if ( sp.y &gt; bounds.bottom ) {
                    sp.y = bounds.bottom;    
                }
            }
            */</span>
            
            <span class="ActionScriptComment">/* and inform the layouter about the dragEvent */</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">sp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span>;
                <span class="ActionScriptDefault_Text">myvnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewToVNodeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">myvnode</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">IEnhancedVisualNode</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">IEnhancedVisualNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">myvnode</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">setNodeLabelCoordinates</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">dragContinue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>, <span class="ActionScriptDefault_Text">myvnode</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* make sure flashplayer does an update after the event */</span>
            <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">updateAfterEvent</span><span class="ActionScriptBracket/Brace">()</span>;            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">handleDragControl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">eRendererComp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">EdgeRenderer</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">controlType</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layoutOrientation</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_moveEdgeInDrag</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_moveGraphInDrag</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//this.parent.dispatchEvent(event);
</span>                <span class="ActionScriptBracket/Brace">}</span>    
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">//var bounds:Rectangle;
</span>            
            <span class="ActionScriptComment">/* we set our Component to be the saved
             * dragComponent, because we cannot access it
             * through the event. */</span>
            <span class="ActionScriptDefault_Text">sp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_dragControlComponent</span>;
            <span class="ActionScriptDefault_Text">eRendererComp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewToVEdgeRendererMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptComment">/* Sometimes we get spurious events */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_dragControlComponent</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;received handleDrag event but _dragComponent is null, ignoring&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;isDragging&apos;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            
            <span class="ActionScriptComment">/* bounds are not implemented:
            bounds = _drag_boundsMap[sp];
            */</span>
            
            <span class="ActionScriptComment">/* update the coordinates with the current
             * event&apos;s stage coordinates (i.e. current mouse position),
             * modified by the lock-center offset */</span>
            
            <span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">eRendererComp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;layoutOrientation&apos;</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">controlType</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;type&apos;</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">oldPos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">controlType</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">EdgeControlRenderer</span>.<span class="ActionScriptDefault_Text">FROM_CONTROL</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dFrom</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_LEFT_RIGHT</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span>
                    <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_RIGHT_LEFT</span><span class="ActionScriptBracket/Brace">))</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">oldPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">x</span>;
                    <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stageX</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">dFrom</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">oldPos</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_BOTTOM_UP</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span>
                    <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_TOP_DOWN</span><span class="ActionScriptBracket/Brace">))</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">oldPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">y</span>;
                    <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stageY</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">dFrom</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">oldPos</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">eRendererComp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;fromDistance&apos;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">dFrom</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">controlType</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">EdgeControlRenderer</span>.<span class="ActionScriptDefault_Text">TO_CONTROL</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dTo</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_BOTTOM_UP</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span>
                    <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_TOP_DOWN</span><span class="ActionScriptBracket/Brace">))</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">oldPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">x</span>
                    <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stageX</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">dTo</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">oldPos</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_LEFT_RIGHT</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span>
                    <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_RIGHT_LEFT</span><span class="ActionScriptBracket/Brace">))</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">oldPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">y</span>
                    <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stageY</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">dTo</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">oldPos</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">eRendererComp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;toDistance&apos;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">dTo</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">//trace(&quot;Drag position: &quot; + _drag_y_offsetMap[sp] + &quot; y = &quot; + sp.y + 
</span>                    <span class="ActionScriptComment">//    &quot; renderer x,y,w,h = &quot; + eRendererComp.x + &apos;,&apos; + eRendererComp.y + &apos;,&apos; + eRendererComp.width + &apos;,&apos; + eRendererComp.height);
</span>                    
            <span class="ActionScriptComment">/* bounds code, currently unused 
            if ( bounds != null ) {
                if ( sp.x &lt; bounds.left ) {
                    sp.x = bounds.left;
                } else if ( sp.x &gt; bounds.right ) {
                    sp.x = bounds.right;
                }    
                if ( sp.y &lt; bounds.top ) {
                    sp.y = bounds.top;    
                } else if ( sp.y &gt; bounds.bottom ) {
                    sp.y = bounds.bottom;    
                }
            }
            */</span>
            
            <span class="ActionScriptComment">/* make sure flashplayer does an update after the event */</span>
            <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">updateAfterEvent</span><span class="ActionScriptBracket/Brace">()</span>;            
        <span class="ActionScriptBracket/Brace">}</span>
        
                <span class="ActionScriptASDoc">/**
         * This handles a background drag (i.e. scroll). The
         * event listener is usually registered with the canvas,
         * i.e. this object.
         * @param event The triggered event.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">backgroundDragBegin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_moveGraphInDrag</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">backgroundDragBegin</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * This method handles the drop event (usually MOUSE_UP).
         * It stops any dragging in progress (including background drag)
         * and unregisters the current dragged node.
         * @param event The triggered event.
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dragEnd</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mycomp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">myback</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">myvnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_UP</span>,<span class="ActionScriptDefault_Text">dragEnd</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_backgroundDragInProgress</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptComment">/* if it was a background drag we stop it here */</span>
                <span class="ActionScriptDefault_Text">_backgroundDragInProgress</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                
                <span class="ActionScriptComment">/* get the background drag object, which is usually
                 * the canvasm so we just set it to this */</span>
                <span class="ActionScriptComment">//myback = (event.currentTarget as DisplayObject);
</span>                <span class="ActionScriptDefault_Text">myback</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">DisplayObject</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">/*
                if(myback == (this as DisplayObject)) {
                    trace(&quot;we found ourselves as the background object GREAT&quot;);
                } else {
                    trace(&quot;we got something else as the background, HMPF&quot;);
                }
                */</span>
                
                <span class="ActionScriptComment">/* no longer needed
                if(myback == null) {
                    /* this can happen if we let go of the button
                     * outside of the window *
                    trace(&quot;dragEnd: background drop event target was no DisplayObject but &quot;+event.currentTarget.toString());
                }
                */</span>
                
                <span class="ActionScriptComment">/* unregister event handler */</span>                
                <span class="ActionScriptDefault_Text">myback</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_MOVE</span>,<span class="ActionScriptDefault_Text">backgroundDragContinue</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">// myback.removeEventListener(MouseEvent.MOUSE_MOVE,dragEnd);
</span>                
                <span class="ActionScriptComment">/* and inform the layouter about the dropEvent */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">bgDropEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ptrObj</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>; 
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_dragComponent</span><span class="ActionScriptBracket/Brace">){</span>
                    <span class="ActionScriptDefault_Text">_dragComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                    
                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">mycomp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span>;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomp</span>.<span class="ActionScriptDefault_Text">stage</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">mycomp</span>.<span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_MOVE</span>, <span class="ActionScriptDefault_Text">handleDrag</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ptrObj</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">mycomp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span>;
                        <span class="ActionScriptDefault_Text">myvnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewToVNodeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">mycomp</span><span class="ActionScriptBracket/Brace">]</span>;
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span><span class="ActionScriptBracket/Brace">)</span> 
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">dropEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>, <span class="ActionScriptDefault_Text">myvnode</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ptrObj</span><span class="ActionScriptBracket/Brace">]</span>;
                        <span class="ActionScriptComment">//TODO, Fix this
</span>                        
                        <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">VGNodeEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VGNodeEvent</span>.<span class="ActionScriptDefault_Text">VG_NODE_END_DRAG</span>, <span class="ActionScriptDefault_Text">myvnode</span>.<span class="ActionScriptDefault_Text">node</span>, <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">))</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_dragControlComponent</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    
                    <span class="ActionScriptDefault_Text">mycomp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_dragControlComponent</span>;
                    
                    <span class="ActionScriptComment">/* reset the dragComponent */</span>
                    <span class="ActionScriptDefault_Text">_dragControlComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                    
                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">mycomp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span>;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomp</span>.<span class="ActionScriptDefault_Text">stage</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">mycomp</span>.<span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_MOVE</span>, <span class="ActionScriptDefault_Text">handleDrag</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ptrObj</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">mycomp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span>;
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span><span class="ActionScriptBracket/Brace">)</span> 
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">dropEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>, <span class="ActionScriptDefault_Text">myvnode</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ptrObj</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptComment">/* remove the event listeners */</span>
                    <span class="ActionScriptComment">//mycomp.stage.removeEventListener(MouseEvent.MOUSE_DOWN, dragEnd);
</span>                    <span class="ActionScriptComment">// HACK: I have to check the stage because there are eventual components not added to the display list
</span>                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomp</span>.<span class="ActionScriptDefault_Text">stage</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">mycomp</span>.<span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_MOVE</span>, <span class="ActionScriptDefault_Text">handleDragControl</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* and stop propagation, as otherwise we could get the
             * event multiple times */</span>
            <span class="ActionScriptComment">//event.stopImmediatePropagation();            
</span>        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dragControlEnd</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_UP</span>,<span class="ActionScriptDefault_Text">dragControlEnd</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_backgroundDragInProgress</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">myback</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject</span>;
                <span class="ActionScriptComment">/* if it was a background drag we stop it here */</span>
                <span class="ActionScriptDefault_Text">_backgroundDragInProgress</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                
                <span class="ActionScriptComment">/* get the background drag object, which is usually
                 * the canvasm so we just set it to this */</span>
                <span class="ActionScriptComment">//myback = (event.currentTarget as DisplayObject);
</span>                <span class="ActionScriptDefault_Text">myback</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">DisplayObject</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">/*
                if(myback == (this as DisplayObject)) {
                    trace(&quot;we found ourselves as the background object GREAT&quot;);
                } else {
                    trace(&quot;we got something else as the background, HMPF&quot;);
                }
                */</span>
                
                <span class="ActionScriptComment">/* no longer needed
                if(myback == null) {
                    /* this can happen if we let go of the button
                     * outside of the window *
                    trace(&quot;dragEnd: background drop event target was no DisplayObject but &quot;+event.currentTarget.toString());
                }
                */</span>
                
                <span class="ActionScriptComment">/* unregister event handler */</span>                
                <span class="ActionScriptDefault_Text">myback</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_MOVE</span>,<span class="ActionScriptDefault_Text">backgroundDragContinue</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">// myback.removeEventListener(MouseEvent.MOUSE_MOVE,dragEnd);
</span>                
                <span class="ActionScriptComment">/* and inform the layouter about the dropEvent */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layouter</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">bgDropEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptComment">/* if it was no background drag, the component
                 * is the saved dragComponent */</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_dragControlComponent</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mycomp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UIComponent</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">myvedge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
                <span class="ActionScriptComment">/* But sometimes the dragComponent was already null, 
                 * in this case we have to ignore the thing. */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sp</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;dragEnd: received dragEnd but _dragComponent was null, ignoring&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">return</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">eRendererComp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">EdgeRenderer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewToVEdgeRendererMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">myvedge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewToVEdgeMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">eRendererComp</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptComment">/* remove the event listeners */</span>
                <span class="ActionScriptComment">//mycomp.stage.removeEventListener(MouseEvent.MOUSE_DOWN, dragEnd);
</span>                <span class="ActionScriptComment">// HACK: I have to check the stage because there are eventual components not added to the display list
</span>                
                <span class="ActionScriptComment">/* bounds are not implemented:
                bounds = _drag_boundsMap[sp];
                */</span>
                
                <span class="ActionScriptComment">/* update the coordinates with the current
                 * event&apos;s stage coordinates (i.e. current mouse position),
                 * modified by the lock-center offset */</span>
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layoutOrientation</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">eRendererComp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;layoutOrientation&apos;</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">controlType</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;type&apos;</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">isDragging</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;isDragging&apos;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Boolean</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">oldPos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isDragging</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">controlType</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">EdgeControlRenderer</span>.<span class="ActionScriptDefault_Text">FROM_CONTROL</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dFrom</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_LEFT_RIGHT</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span>
                            <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_RIGHT_LEFT</span><span class="ActionScriptBracket/Brace">))</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">oldPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">x</span>;
                            <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stageX</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;
                            <span class="ActionScriptDefault_Text">dFrom</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">oldPos</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_BOTTOM_UP</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span>
                            <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_TOP_DOWN</span><span class="ActionScriptBracket/Brace">))</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">oldPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">y</span>;
                            <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stageY</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;
                            <span class="ActionScriptDefault_Text">dFrom</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">oldPos</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptDefault_Text">eRendererComp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;fromDistance&apos;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">dFrom</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">controlType</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">EdgeControlRenderer</span>.<span class="ActionScriptDefault_Text">TO_CONTROL</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dTo</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_BOTTOM_UP</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span>
                            <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_TOP_DOWN</span><span class="ActionScriptBracket/Brace">))</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">oldPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">x</span>
                            <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stageX</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleX</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;
                            <span class="ActionScriptDefault_Text">dTo</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">oldPos</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_LEFT_RIGHT</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span>
                            <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layoutOrientation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">HierarchicalLayouter</span>.<span class="ActionScriptDefault_Text">ORIENT_RIGHT_LEFT</span><span class="ActionScriptBracket/Brace">))</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">oldPos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">y</span>
                            <span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">stageY</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">scaleY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">]</span>;
                            <span class="ActionScriptDefault_Text">dTo</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sp</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">oldPos</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        
                        <span class="ActionScriptDefault_Text">eRendererComp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;toDistance&apos;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">dTo</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptComment">/* reset the dragComponent */</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ptrObj</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>;
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">mycomp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mycomp</span>.<span class="ActionScriptDefault_Text">stage</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">mycomp</span>.<span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_MOVE</span>, <span class="ActionScriptDefault_Text">handleDragControl</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_drag_x_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ptrObj</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">mycomp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ptrObj</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">UIComponent</span>;
                    <span class="ActionScriptReserved">delete</span> <span class="ActionScriptDefault_Text">_drag_y_offsetMap</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ptrObj</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">_dragControlComponent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptDefault_Text">sp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;isDragging&apos;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                
                <span class="ActionScriptDefault_Text">_canvas</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">MOUSE_UP</span>,<span class="ActionScriptDefault_Text">dragControlEnd</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isDragging</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">VGEdgeEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VGEdgeEvent</span>.<span class="ActionScriptDefault_Text">VG_EDGE_CONTROL_END_DRAG</span>, <span class="ActionScriptDefault_Text">myvedge</span>.<span class="ActionScriptDefault_Text">edge</span>, <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">))</span>;
                
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* and stop propagation, as otherwise we could get the
             * event multiple times */</span>
            <span class="ActionScriptComment">//event.stopImmediatePropagation();            
</span>        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">flags</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptOperator">=</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">flags</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//_canvas.dispatchEvent(new VGraphEvent(VGraphEvent.VGRAPH_CHANGED)); 
</span>        <span class="ActionScriptBracket/Brace">}</span> 
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">enableDefaultDoubleClick</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_enableDefaultDoubleClick</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">enableDefaultDoubleClick</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_enableDefaultDoubleClick</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">nodeDoubleClick</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_enableDefaultDoubleClick</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">nodeDoubleClick</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">enableDragNodeWithSubTree</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_enableDragNodeWithSubTree</span>;
        <span class="ActionScriptBracket/Brace">}</span>
            
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">enableDragNodeWithSubTree</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_enableDragNodeWithSubTree</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createVNodeFromVO</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sid</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmpVEdge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmpEdge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">edgeData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">node</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
                
            <span class="ActionScriptDefault_Text">node</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">createNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sid</span>, <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createVNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">setNodeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vnode</span>, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">vnode</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addVNodeAsChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sid</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>, <span class="ActionScriptDefault_Text">parentNode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmpVEdge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmpEdge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">edgeData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">node</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
                
            <span class="ActionScriptDefault_Text">node</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">createNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sid</span>, <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createVNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">setNodeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vnode</span>, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nodeID</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">stringid</span>;
            <span class="ActionScriptDefault_Text">edgeData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">()</span>
            <span class="ActionScriptDefault_Text">edgeData</span>.<span class="ActionScriptDefault_Text">fromID</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parentNode</span>.<span class="ActionScriptDefault_Text">stringid</span>;
            <span class="ActionScriptDefault_Text">edgeData</span>.<span class="ActionScriptDefault_Text">toID</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">stringid</span>;
            
            <span class="ActionScriptDefault_Text">tmpEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">link</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentNode</span>,<span class="ActionScriptDefault_Text">node</span>,<span class="ActionScriptDefault_Text">edgeData</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Could not create or find Graph edge!!&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span>.<span class="ActionScriptDefault_Text">vedge</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">/* we have a new edge, so we create a new VEdge */</span>
                    <span class="ActionScriptDefault_Text">tmpVEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createVEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">/* existing one, so we use the existing vedge */</span>
                    <span class="ActionScriptDefault_Text">tmpVEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmpEdge</span>.<span class="ActionScriptDefault_Text">vedge</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addVNodeToEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sid</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>, <span class="ActionScriptDefault_Text">edge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span>, <span class="ActionScriptDefault_Text">removeOldEdge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fromNode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">edge</span>.<span class="ActionScriptDefault_Text">fromNode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">toNode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">edge</span>.<span class="ActionScriptDefault_Text">toNode</span>;    
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmpVEdge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmpEdge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">edgeData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">node</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>;
            
            <span class="ActionScriptDefault_Text">node</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">createNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sid</span>, <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;id&apos;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">stringid</span>;

            <span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createVNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">setNodeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vnode</span>, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nodeID</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">stringid</span>;
                            
            <span class="ActionScriptDefault_Text">edgeData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">edgeData</span>.<span class="ActionScriptDefault_Text">fromID</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fromNode</span>.<span class="ActionScriptDefault_Text">stringid</span>;
            <span class="ActionScriptDefault_Text">edgeData</span>.<span class="ActionScriptDefault_Text">toID</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">stringid</span>;
            
            <span class="ActionScriptComment">//tmpVEdge = linkNodes(fromNode.vnode, node.vnode, edgeData);
</span>            
            <span class="ActionScriptDefault_Text">tmpEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">link</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fromNode</span>,<span class="ActionScriptDefault_Text">node</span>,<span class="ActionScriptDefault_Text">edgeData</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Could not create or find Graph edge!!&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span>.<span class="ActionScriptDefault_Text">vedge</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">/* we have a new edge, so we create a new VEdge */</span>
                    <span class="ActionScriptDefault_Text">tmpVEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createVEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">/* existing one, so we use the existing vedge */</span>
                    <span class="ActionScriptDefault_Text">tmpVEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmpEdge</span>.<span class="ActionScriptDefault_Text">vedge</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">edgeData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">edgeData</span>.<span class="ActionScriptDefault_Text">fromID</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">stringid</span>;
            <span class="ActionScriptDefault_Text">edgeData</span>.<span class="ActionScriptDefault_Text">toID</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toNode</span>.<span class="ActionScriptDefault_Text">stringid</span>;
            <span class="ActionScriptComment">//tmpVEdge = linkNodes(node.vnode, toNode.vnode, edgeData);
</span>            
            <span class="ActionScriptDefault_Text">tmpEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">link</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span>,<span class="ActionScriptDefault_Text">toNode</span>,<span class="ActionScriptDefault_Text">edgeData</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Could not create or find Graph edge!!&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span>.<span class="ActionScriptDefault_Text">vedge</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">/* we have a new edge, so we create a new VEdge */</span>
                    <span class="ActionScriptDefault_Text">tmpVEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createVEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">/* existing one, so we use the existing vedge */</span>
                    <span class="ActionScriptDefault_Text">tmpVEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmpEdge</span>.<span class="ActionScriptDefault_Text">vedge</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">removeOldEdge</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//unlinkNodes(fromNode.vnode, toNode.vnode);
</span>                <span class="ActionScriptDefault_Text">tmpEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">getEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fromNode</span>,<span class="ActionScriptDefault_Text">toNode</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">tmpVEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmpEdge</span>.<span class="ActionScriptDefault_Text">vedge</span>;            
                    <span class="ActionScriptDefault_Text">removeVEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpVEdge</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">removeEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeNodeWithOption</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>, <span class="ActionScriptDefault_Text">rebindEdge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vnode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">vnode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">successors</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">successors</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">precessors</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">predecessors</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmpEdge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmpVEdge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rebindEdge</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">precessors</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 1<span class="ActionScriptBracket/Brace">))</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">precessor</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">precessors</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">INode</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">oldEdge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">getEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">precessor</span>, <span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">oldEdge</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">successors</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fromNode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">precessor</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">toNode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">successors</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">INode</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">edgeData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ObjectUtil</span>.<span class="ActionScriptDefault_Text">copy</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">oldEdge</span>.<span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">edgeData</span>.<span class="ActionScriptDefault_Text">toID</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">toNode</span>.<span class="ActionScriptDefault_Text">stringid</span>;
                        <span class="ActionScriptDefault_Text">tmpEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">link</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fromNode</span>,<span class="ActionScriptDefault_Text">toNode</span>,<span class="ActionScriptDefault_Text">edgeData</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Could not create or find Graph edge!!&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span>.<span class="ActionScriptDefault_Text">vedge</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptComment">/* we have a new edge, so we create a new VEdge */</span>
                                <span class="ActionScriptDefault_Text">tmpVEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createVEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptComment">/* existing one, so we use the existing vedge */</span>
                                <span class="ActionScriptDefault_Text">tmpVEdge</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmpEdge</span>.<span class="ActionScriptDefault_Text">vedge</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">removeNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vnode</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Removes a subtree from the main tree for which the root node is @node.
         */</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeSubTree</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>, <span class="ActionScriptDefault_Text">isRootNodeRemovable</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">isRootNodeRemovable</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">currentRootVNode</span><span class="ActionScriptBracket/Brace">))</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
                
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">arrTreeRoots</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nextTreeRoot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">curTreeRoot</span>.<span class="ActionScriptDefault_Text">successors</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nextTreeRoot</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">removeNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curTreeRoot</span>.<span class="ActionScriptDefault_Text">vnode</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">curTreeRoot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Removes all hierarchical children of the node referred to by parameter
         * @node.
         */</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeNodeChildren</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">arrTreeRoots</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nextTreeRoot1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">successors</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nextTreeRoot</span><span class="ActionScriptBracket/Brace">)</span>;
                
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nextTreeRoot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">curTreeRoot</span>.<span class="ActionScriptDefault_Text">successors</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nextTreeRoot</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">removeNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curTreeRoot</span>.<span class="ActionScriptDefault_Text">vnode</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">curTreeRoot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setVNodeData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span>, <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>;
            <span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">view</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">IDataRenderer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">view</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setVEdgeData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span>, <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>;
            <span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">edge</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">labelView</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">IDataRenderer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ve</span>.<span class="ActionScriptDefault_Text">labelView</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ve</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setVisibleNodeWithRelated</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_layouter</span>.<span class="ActionScriptDefault_Text">resetAll</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmpNode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualNode</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_visibleVNodes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setNodeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpNode</span>, <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IEdge</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">edges</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setEdgeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">vedge</span>, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
                                
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">enode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn</span>.<span class="ActionScriptDefault_Text">node</span>;
                    
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">arrTreeNodes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ArrayCollection</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">arrTreeRoots</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">enode</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrTreeNodes</span>.<span class="ActionScriptDefault_Text">contains</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">arrTreeNodes</span>.<span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">if</span>     <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curTreeRoot</span>.<span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">currentRootVNode</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">prevTreeRoot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">curTreeRoot</span>.<span class="ActionScriptDefault_Text">predecessors</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">prevTreeRoot</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">prevTreeRoot</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">curTreeRoot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">arrTreeRoots</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">enode</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">curTreeRoot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrTreeNodes</span>.<span class="ActionScriptDefault_Text">contains</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">arrTreeNodes</span>.<span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curTreeRoot</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nextTreeRoot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">curTreeRoot</span>.<span class="ActionScriptDefault_Text">successors</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nextTreeRoot</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nextTreeRoot</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">curTreeRoot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">arrTreeRoots</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">movedNode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">arrTreeNodes</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setNodeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">movedNode</span>.<span class="ActionScriptDefault_Text">vnode</span>, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmpEdge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualEdge</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_visibleVEdges</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span>.<span class="ActionScriptDefault_Text">edge</span>.<span class="ActionScriptDefault_Text">fromNode</span>.<span class="ActionScriptDefault_Text">vnode</span>.<span class="ActionScriptDefault_Text">isVisible</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptOperator">||</span>
                    <span class="ActionScriptDefault_Text">tmpEdge</span>.<span class="ActionScriptDefault_Text">edge</span>.<span class="ActionScriptDefault_Text">toNode</span>.<span class="ActionScriptDefault_Text">vnode</span>.<span class="ActionScriptDefault_Text">isVisible</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">setEdgeVisibility</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpEdge</span>, <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
