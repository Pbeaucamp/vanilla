<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>ConcentricRadialLayouter.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">/* 
 * The MIT License
 *
 * Copyright (c) 2007 The SixDegrees Project Team
 * (Jason Bellone, Juan Rodriguez, Segolene de Basquiat, Daniel Lang).
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the &quot;Software&quot;), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */</span>
<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">graphLayout</span>.<span class="ActionScriptDefault_Text">layout</span> <span class="ActionScriptBracket/Brace">{</span>

    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">Point</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">graphLayout</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">IGTree</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">graphLayout</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">INode</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">graphLayout</span>.<span class="ActionScriptDefault_Text">visual</span>.<span class="ActionScriptDefault_Text">IVisualGraph</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">Geometry</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">un</span>.<span class="ActionScriptDefault_Text">cava</span>.<span class="ActionScriptDefault_Text">birdeye</span>.<span class="ActionScriptDefault_Text">ravis</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">LogUtil</span>;
    
    <span class="ActionScriptASDoc">/**
     * This is an implementation of the generic radial
     * layout algorithm that uses concentric rings
     * for the distance. In addition it will implement
     * the animation algorithm by Yee et. al that moves
     * nodes along their circles instead of in straight
     * lines.
     * */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">ConcentricRadialLayouter</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">AnimatedBaseLayouter</span> <span class="ActionScriptReserved">implements</span> <span class="ActionScriptDefault_Text">ILayoutAlgorithm</span> <span class="ActionScriptBracket/Brace">{</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">_LOG</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;graphLayout.layout.ConcentricRadialLayouter&quot;</span>;
        
        <span class="ActionScriptASDoc">/**
         * The default radius increase between
         * the concentric circles.
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">DEFAULT_RADIUS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 50;
        
        <span class="ActionScriptASDoc">/**
         * @internal
         * we need a previous root for the animation */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_previousRoot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;        
        
        <span class="ActionScriptASDoc">/**
         * @internal
         * the current maximum depth of the tree */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_maxDepth</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        
        <span class="ActionScriptASDoc">/**
         * @internal
         * the current radius increase for each circle */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_radiusInc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0;
        
        <span class="ActionScriptComment">/* the two bounding angles */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_theta1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_theta2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_setBounds</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;        
        
        <span class="ActionScriptComment">/* if we add views the initial size is 0,
         * so we just keep track of the other nodes and
         * use the largest size of a node to measure
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_maxviewwidth</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_maxviewheight</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0;

        <span class="ActionScriptASDoc">/**
         * this holds the data for a layout drawing.
         * */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_currentDrawing</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ConcentricRadialLayoutDrawing</span>;

        <span class="ActionScriptASDoc">/**
         * The constructor initializes the layouter and may assign
         * already a VisualGraph object, but this can also be set later.
         * @param vg The VisualGraph object on which this layouter should work on.
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">ConcentricRadialLayouter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IVisualGraph</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
        
            <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vg</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* this is inherited */</span>
            <span class="ActionScriptDefault_Text">animationType</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ANIM_RADIAL</span>;
            
            <span class="ActionScriptDefault_Text">_currentDrawing</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            
            <span class="ActionScriptDefault_Text">_radiusInc</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">DEFAULT_RADIUS</span>;
            <span class="ActionScriptDefault_Text">_previousRoot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_theta1</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">_theta2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_theta1</span> <span class="ActionScriptOperator">+</span> 360;
            <span class="ActionScriptDefault_Text">_setBounds</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            
            <span class="ActionScriptDefault_Text">_maxviewwidth</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">MINIMUM_NODE_WIDTH</span>;
            <span class="ActionScriptDefault_Text">_maxviewheight</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">MINIMUM_NODE_HEIGHT</span>;
            
            <span class="ActionScriptDefault_Text">initDrawing</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">resetAll</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">resetAll</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">_stree</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">purgeTrees</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * */</span>
        <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">linkLength</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_radiusInc</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">r</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">linkLength</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_radiusInc</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         * @internal
         * This method does the real layout pass, 
         * i.e. a full calculation of the new layout and
         * animating the nodes moving into the new position.
         * */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">layoutPass</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
             <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rv</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nodes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cindex</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
    
            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;layoutPass called&quot;);
</span>            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">_vgraph</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;No Vgraph set in ConcentricRadialLayouter, aborting&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">_vgraph</span>.<span class="ActionScriptDefault_Text">currentRootVNode</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;This Layouter always requires a root node!&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* nothing to do if we have no nodes */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">noNodes</span> <span class="ActionScriptOperator">&lt;</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">killTimer</span><span class="ActionScriptBracket/Brace">()</span>;
                
            <span class="ActionScriptComment">/* establish the current root, if it has 
             * changed we need to reinit the drawing */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_root</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">_vgraph</span>.<span class="ActionScriptDefault_Text">currentRootVNode</span>.<span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">/* don&apos;t forget to save the root here */</span>
                <span class="ActionScriptDefault_Text">_previousRoot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_root</span>;
                <span class="ActionScriptDefault_Text">_root</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_vgraph</span>.<span class="ActionScriptDefault_Text">currentRootVNode</span>.<span class="ActionScriptDefault_Text">node</span>;
                <span class="ActionScriptDefault_Text">_layoutChanged</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* we test to always reinit the drawing */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layoutChanged</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">initDrawing</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;CCLayouter: current root:&quot;+_root.id);
</span>    
            <span class="ActionScriptComment">/* set the coordinates in the drawing of root
             * to 0,0 */</span>
            <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">setCartCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_root</span>,<span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span>0,0<span class="ActionScriptBracket/Brace">))</span>;
            
            <span class="ActionScriptComment">/* establish the spanning tree, but have it restricted to
             * visible nodes */</span>
            <span class="ActionScriptDefault_Text">_stree</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_graph</span>.<span class="ActionScriptDefault_Text">getTree</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_root</span>, <span class="ActionScriptReserved">true</span>, <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* calculate the relative width and the
             * new max Depth */</span>
            <span class="ActionScriptDefault_Text">_maxDepth</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">calcAngularWidth</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_root</span>,0<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* calculate the radius increment to fit the screen */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_autoFitEnabled</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">autoFit</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* we may have preset angular bounds
             * XXX this is untested, yet */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_setBounds</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">calcAngularBounds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_root</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* do a static layout pass */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_maxDepth</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">calculateStaticLayout</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_root</span>,<span class="ActionScriptDefault_Text">_radiusInc</span>,<span class="ActionScriptDefault_Text">_theta1</span>,<span class="ActionScriptDefault_Text">_theta2</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* now if we have no previous drawing we can just
             * apply the result and display it
             * if we do have (but maybe even if we don&apos;t have)
             * we interpolate the polar coordinates of the nodes */</span>
            
            
            <span class="ActionScriptDefault_Text">resetAnimation</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptComment">/* start the animation by interpolating polar coordinates */</span>
            <span class="ActionScriptDefault_Text">startAnimation</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptDefault_Text">_layoutChanged</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">rv</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Presets the angular bounds of the layout, if desired.
         * This allows to restrict the layout from drawing a full circle
         * to only draw in a segment of the circle.
         * WARNING: XXX THIS HAS NOT BEEN TESTED YET
         * @param theta The starting angle in radians of the bounding segment. Default is 0.
         * @param width The angular width of the segment in radians. Default is 2*PI.
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setAngularBounds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">theta</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_theta1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">theta</span>;
            <span class="ActionScriptDefault_Text">_theta2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_theta1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">width</span>;
            <span class="ActionScriptDefault_Text">_setBounds</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptComment">/*
         * private functions
         * */</span>
         
        <span class="ActionScriptASDoc">/**
         * @internal
         * create a new layout model object, which is required
         * on any root change (and possibly during other occasions)
         * */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">initDrawing</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>            
            <span class="ActionScriptDefault_Text">_currentDrawing</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ConcentricRadialLayoutDrawing</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptComment">/* don&apos;t forget to set the object also in the 
             * BaseLayouter */</span>
            <span class="ActionScriptReserved">super</span>.<span class="ActionScriptDefault_Text">currentDrawing</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_currentDrawing</span>;
            
            <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">originOffset</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_vgraph</span>.<span class="ActionScriptDefault_Text">origin</span>;
            <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">centerOffset</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_vgraph</span>.<span class="ActionScriptDefault_Text">center</span>;
            <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">centeredLayout</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;New Drawing with origin:&quot;+_currentDrawing.originOffset.toString());
</span>        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @internal
         * this autofit method sets the radius increment
         * so that it should fit into the screen
         * */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">autoFit</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptDefault_Text">r</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">min</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_vgraph</span>.<span class="ActionScriptDefault_Text">width</span>, <span class="ActionScriptDefault_Text">_vgraph</span>.<span class="ActionScriptDefault_Text">height</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 2.0;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_maxDepth</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_radiusInc</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">r</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span>2 <span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">DEFAULT_MARGIN</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">_maxDepth</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @internal
         * This calculates the angular width of a subtree.
         * @param n the root node of the subtree.
         * @param d the current depth.
         * @return The angular width of the subtree rooted in n at level d.
         * */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">calcAngularWidth</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>, <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">aw</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nw</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nh</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">diameter</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>; <span class="ActionScriptComment">// child node
</span>            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Node to calculate Angular width is null&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">vnode</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Node has no vnode&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            
            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;CalcAngWidth called with node:&quot;+n.id+&quot; and depth:&quot;+d);
</span>            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">vnode</span>.<span class="ActionScriptDefault_Text">isVisible</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">LogUtil</span>.<span class="ActionScriptDefault_Text">warn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_LOG</span>, <span class="ActionScriptString">&quot;Node:&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot; not yet visible but called in angular width calc&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span> 0;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* update current max Depth */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">_maxDepth</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_maxDepth</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* the following two may be 0 in an early stage
             * so we have to get around that issue 
             * if it is 0 we assign a default size */</span>
            <span class="ActionScriptDefault_Text">nw</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">vnode</span>.<span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">width</span>;
            <span class="ActionScriptDefault_Text">nh</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">n</span>.<span class="ActionScriptDefault_Text">vnode</span>.<span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">height</span>;
            
            <span class="ActionScriptComment">/* update the max view width and height */</span>
            <span class="ActionScriptDefault_Text">_maxviewwidth</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">max</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_maxviewwidth</span>, <span class="ActionScriptDefault_Text">nw</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_maxviewheight</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">max</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_maxviewheight</span>, <span class="ActionScriptDefault_Text">nh</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nw</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">nw</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_maxviewwidth</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nh</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">nh</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_maxviewheight</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;nodes width:&quot;+nw+&quot; height:&quot;+nh);
</span>            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">diameter</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptComment">// root node 
</span>            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">/* in another implementation this divided the real
                 * diameter by d not by d times the radiusINcrement
                 * which yields way too large values */</span>
                <span class="ActionScriptDefault_Text">diameter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nw</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nw</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">nh</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nh</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">_radiusInc</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* diameter is an angular width value in radians,
             * so we convert it to degrees when used */</span>
            <span class="ActionScriptDefault_Text">diameter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Geometry</span>.<span class="ActionScriptDefault_Text">rad2deg</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">diameter</span><span class="ActionScriptBracket/Brace">)</span>;
            
            
            <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;depth:&quot;+d+&quot; diameter:&quot;+diameter);
</span>            
            <span class="ActionScriptComment">/* here the code checks if the node &apos;is expanded&apos;
             * which means if he has visible children
             * we do it differently, if the node is invisible
             * his angular width is 0, so is it for all his
             * children in case they are not visible
             * this may be a bit less efficient, but it fits
             * our code */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_stree</span>.<span class="ActionScriptDefault_Text">getNoChildren</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;node:&quot;+n.id+&quot; has children...&quot;);
</span>                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cn</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_stree</span>.<span class="ActionScriptDefault_Text">getChildren</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">aw</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">calcAngularWidth</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cn</span>, <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;current aw for node:&quot;+n.id+&quot; is:&quot;+aw);
</span>                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">aw</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">max</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">diameter</span>,<span class="ActionScriptDefault_Text">aw</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;node:&quot;+n.id+&quot; has NO children...&quot;);
</span>                <span class="ActionScriptDefault_Text">aw</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">diameter</span>;
                <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;current aw for node:&quot;+n.id+&quot; is:&quot;+aw);
</span>            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">setAngularWidth</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span>,<span class="ActionScriptDefault_Text">aw</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//LogUtil.warn(_LOG, &quot;Set angular witdh of node:&quot;+n.id+&quot; to:&quot;+aw);
</span>            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">aw</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @internal
         * This calculates the angular bounds of the layout
         * based on the last layout and the set bounds.
         * @param r The current root node.
         * */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">calcAngularBounds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ppr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">oldtree</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IGTree</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rw</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pw</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">childorder</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cindex</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Point</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Point</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_previousRoot</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">r</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">_previousRoot</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_previousRoot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">r</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">ppr</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_stree</span>.<span class="ActionScriptDefault_Text">parents</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_previousRoot</span><span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptComment">/* maybe we have no parent ?*/</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ppr</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_previousRoot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">r</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* now ppr is the parent node of the previous root */</span>
            
            <span class="ActionScriptDefault_Text">childorder</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">calculateSortChildrenArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">r</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">cc</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">childorder</span>.<span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">cc</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">/* get the index from the sorted array, beware that
                 * the indexes should start with 0, have to make sure
                 * this is the case in the calculate sort function */</span>
                <span class="ActionScriptDefault_Text">cindex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">childorder</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_stree</span>.<span class="ActionScriptDefault_Text">getIthChildPerNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">r</span>,<span class="ActionScriptDefault_Text">cindex</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">/* unclear purpose, probably a root node */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">ppr</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">dt</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">getAngularWidth</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">rw</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">getAngularWidth</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">r</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">pw</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">getAngularWidth</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ppr</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">dt</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span>360 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dt</span><span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pw</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">rw</span>;
            
            <span class="ActionScriptDefault_Text">rp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">getRelCartCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">r</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">pp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">getRelCartCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ppr</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* now set the angular bounds */</span>
            <span class="ActionScriptDefault_Text">_theta1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dt</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">Geometry</span>.<span class="ActionScriptDefault_Text">rad2deg</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">atan2</span><span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">pp</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">rp</span>.<span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>,<span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pp</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">rp</span>.<span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)))</span>;
            <span class="ActionScriptDefault_Text">_theta2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_theta1</span> <span class="ActionScriptOperator">+</span> 360;
            <span class="ActionScriptDefault_Text">_previousRoot</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">r</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * @internal
         * Creates an array which in turn holds the indexes
         * of the children according to the ordered defined by
         * the current angular orientation of the nodes.
         * @param n The node whose children should be sorted.
         * @return An Array of indexes, which may be used in the getIthChildPerNode() method of the GTree.
         * @see org.un.cava.birdeye.ravis.graphLayout.data.IGTree#getIthChildPerNode()
         * */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">calculateSortChildrenArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">base</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">angles</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>; <span class="ActionScriptComment">// an array of Numbers, i.e. of the angles of the children
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">result</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>; <span class="ActionScriptComment">// the resulting sort order array
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>; <span class="ActionScriptComment">//parent node
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>; <span class="ActionScriptComment">// current child
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Point</span>; <span class="ActionScriptComment">// parent point
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">np</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Point</span>; <span class="ActionScriptComment">// node point
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Point</span>; <span class="ActionScriptComment">// child point
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            
            <span class="ActionScriptDefault_Text">base</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">pn</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_stree</span>.<span class="ActionScriptDefault_Text">parents</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptComment">/* we need that anyway */</span>
            <span class="ActionScriptDefault_Text">np</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">getRelCartCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pn</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">pp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">getRelCartCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pn</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">base</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Geometry</span>.<span class="ActionScriptDefault_Text">rad2deg</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Geometry</span>.<span class="ActionScriptDefault_Text">normaliseAngle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">atan2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pp</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">np</span>.<span class="ActionScriptDefault_Text">y</span>, <span class="ActionScriptDefault_Text">pp</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">np</span>.<span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)))</span>; 
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// else base remains 0
</span>            
            <span class="ActionScriptDefault_Text">cc</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_stree</span>.<span class="ActionScriptDefault_Text">getNoChildren</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">/* if we have no children, the array is empty, thus null */</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cc</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;Node n:&quot;+n.id+&quot; has no children, returning null sort array&quot;);
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">/* now the java code uses some hack to determine
             * if a branch was newly expanded checking the isStartVisible
             * property of a node, which is unclear what it really does
             * we ignore this part for now */</span>
            
            <span class="ActionScriptDefault_Text">angles</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">cc</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">cn</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_stree</span>.<span class="ActionScriptDefault_Text">getIthChildPerNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span>,<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">cp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">getRelCartCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cn</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">angles</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Geometry</span>.<span class="ActionScriptDefault_Text">normaliseAngleDeg</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">base</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">Geometry</span>.<span class="ActionScriptDefault_Text">rad2deg</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">atan2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">np</span>.<span class="ActionScriptDefault_Text">y</span>, <span class="ActionScriptDefault_Text">cp</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">np</span>.<span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)))</span>;
                
                <span class="ActionScriptComment">/*
                LogUtil.debug(_LOG, &quot;childorder angle for child:&quot;+cn.id+&quot; of node:&quot;+n.id+&quot; has base:&quot;+base+
                    &quot; and angle:&quot;+(angles[i] / (2*Math.PI) * 360));
                */</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">result</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">angles</span>.<span class="ActionScriptDefault_Text">sort</span><span class="ActionScriptBracket/Brace">(A</span><span class="ActionScriptDefault_Text">rray</span>.<span class="ActionScriptDefault_Text">NUMERIC</span> <span class="ActionScriptOperator">|</span> <span class="ActionScriptDefault_Text">Array</span>.<span class="ActionScriptDefault_Text">RETURNINDEXEDARRAY</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">/*
            LogUtil.debug(_LOG, &quot;Built indexarray:&quot;+result.toString()+&quot; of array:&quot;+angles.toString()+
                &quot; for children:&quot;+_stree.getChildren(n).toString());
            */</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">result</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * @internal
         * calculate recursiveley the layout of the current
         * subtree
         * @param n The root of the current subtree.
         * @param r The current radius (distance from center).
         * @param theta1 The start of the current subtrees angular bounds region.
         * @param theta2 The end of the current subtrees angular bounds region.
         * */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">calculateStaticLayout</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>, <span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">theta1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">theta2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dtheta</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dtheta2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">awidth</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cfrac</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nfrac</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">childorder</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cindex</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">INode</span>;

            <span class="ActionScriptDefault_Text">dtheta</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">theta2</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">theta1</span>;
            <span class="ActionScriptDefault_Text">dtheta2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dtheta</span> <span class="ActionScriptOperator">/</span> 2.0;
            <span class="ActionScriptDefault_Text">nfrac</span> <span class="ActionScriptOperator">=</span> 0.0;
            <span class="ActionScriptDefault_Text">cfrac</span> <span class="ActionScriptOperator">=</span> 0.0;
            <span class="ActionScriptDefault_Text">awidth</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">getAngularWidth</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">)</span>;    
            
            <span class="ActionScriptDefault_Text">childorder</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">calculateSortChildrenArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">cc</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">childorder</span>.<span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">cc</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptComment">/* get the index from the sorted array */</span>                
                <span class="ActionScriptDefault_Text">cindex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">childorder</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptDefault_Text">cn</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_stree</span>.<span class="ActionScriptDefault_Text">getIthChildPerNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span>,<span class="ActionScriptDefault_Text">cindex</span><span class="ActionScriptBracket/Brace">)</span>;            
                <span class="ActionScriptDefault_Text">cfrac</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">getAngularWidth</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cn</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">awidth</span>;
                
                <span class="ActionScriptComment">/* do we need to recurse, 
                 * we just recurse if the node has children */</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_stree</span>.<span class="ActionScriptDefault_Text">getNoChildren</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cn</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">calculateStaticLayout</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cn</span>, <span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">_radiusInc</span>, 
                        <span class="ActionScriptDefault_Text">theta1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nfrac</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">dtheta</span><span class="ActionScriptBracket/Brace">)</span>,
                        <span class="ActionScriptDefault_Text">theta1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">nfrac</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cfrac</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">dtheta</span><span class="ActionScriptBracket/Brace">))</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">//LogUtil.debug(_LOG, &quot;CSL: current radius:&quot;+r);
</span>                <span class="ActionScriptDefault_Text">_currentDrawing</span>.<span class="ActionScriptDefault_Text">setPolarCoordinates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cn</span>, <span class="ActionScriptDefault_Text">r</span>, <span class="ActionScriptDefault_Text">theta1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nfrac</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dtheta</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cfrac</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dtheta2</span><span class="ActionScriptBracket/Brace">))</span>;
                
                <span class="ActionScriptComment">/* set the orientation in the visual node */</span>
                <span class="ActionScriptDefault_Text">cn</span>.<span class="ActionScriptDefault_Text">vnode</span>.<span class="ActionScriptDefault_Text">orientAngle</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">theta1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nfrac</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dtheta</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cfrac</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dtheta2</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">nfrac</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">cfrac</span>;    
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
