DROP TABLE profiling.aggregates;

ALTER TABLE `profiling`.`querie_info` RENAME TO `profiling`.`analysis_info`,
 CHANGE COLUMN `QI_ID` `A_ID` INTEGER UNSIGNED NOT NULL DEFAULT NULL AUTO_INCREMENT,
 CHANGE COLUMN `QI_NAME` `A_NAME` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
 CHANGE COLUMN `QI_DESC` `A_DESC` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
 CHANGE COLUMN `QI_CREATION` `A_CREATION` TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
 CHANGE COLUMN `QI_UPDATE` `A_UPDATE` TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
 DROP PRIMARY KEY,
 ADD PRIMARY KEY  USING BTREE(`A_ID`);
 
 ALTER TABLE `profiling`.`analysis_info` ADD COLUMN `A_CREATOR` VARCHAR(45) AFTER `A_UPDATE`;
 ALTER TABLE `profiling`.`analysis_info` ADD COLUMN `A_CONNECTION_ID` INTEGER UNSIGNED NOT NULL AFTER `A_CREATOR`;
 
 CREATE TABLE `profiling`.`tags` (
  `T_ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `T_CREATOR` VARCHAR(45),
  `T_CREATION_DATE` DATETIME,
  `T_UPDATE_DATE` DATETIME,
  `T_COMMENT` MEDIUMTEXT,
  `T_ANALYSIS_ID` INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY (`T_ID`)
)
ENGINE = InnoDB;

CREATE TABLE `profiling`.`analysis_content` (
  `AC_ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `AC_ANALYSIS_ID` INTEGER UNSIGNED NOT NULL,
  `AC_TABLE_NAME` MEDIUMTEXT,
  `AC_COLUMN_NAME` MEDIUMTEXT,
  PRIMARY KEY (`AC_ID`)
)
ENGINE = InnoDB;


ALTER TABLE `profiling`.`query_results` RENAME TO `profiling`.`analysis_results`,
 CHANGE COLUMN `QR_ID` `AR_ID` INTEGER UNSIGNED NOT NULL DEFAULT NULL AUTO_INCREMENT,
 CHANGE COLUMN `QR_QUERY_ID` `AR_ANALYSIS_CONTENT_ID` INTEGER UNSIGNED NOT NULL DEFAULT 0,
 DROP COLUMN `QR_LABELS`,
 CHANGE COLUMN `QR_DATE` `AR_DATE` DATETIME NOT NULL DEFAULT '0000-00-00 00:00:00',
 DROP PRIMARY KEY,
 ADD PRIMARY KEY  USING BTREE(`AR_ID`);

 ALTER TABLE `profiling`.`analysis_results` DROP COLUMN `QR_RESULT`;
 
 
 ALTER TABLE `profiling`.`analysis_results` MODIFY COLUMN `AR_ANALYSIS_CONTENT_ID` INTEGER UNSIGNED DEFAULT 0,
 MODIFY COLUMN `AR_DATE` DATETIME DEFAULT '0000-00-00 00:00:00',
 ADD COLUMN `AR_DATA_TYPE` VARCHAR(45) AFTER `AR_DATE`,
 ADD COLUMN `AR_LOW_VALUE` DOUBLE AFTER `AR_DATA_TYPE`,
 ADD COLUMN `AR_HIGHT_VALUE` DOUBLE AFTER `AR_LOW_VALUE`,
 ADD COLUMN `AR_LOW_VALUE_COUNT` INTEGER UNSIGNED AFTER `AR_HIGHT_VALUE`,
 ADD COLUMN `AR_HIGHT_VALUE_COUNT` INTEGER UNSIGNED AFTER `AR_LOW_VALUE_COUNT`,
 ADD COLUMN `AR_AVG_VALUE` DOUBLE AFTER `AR_HIGHT_VALUE_COUNT`,
 ADD COLUMN `AR_DISTINCT_COUNT` INTEGER UNSIGNED AFTER `AR_AVG_VALUE`,
 ADD COLUMN `AR_NULL_COUNT` INTEGER UNSIGNED AFTER `AR_DISTINCT_COUNT`,
 ADD COLUMN `AR_NULL_PERC` DOUBLE AFTER `AR_NULL_COUNT`,
 ADD COLUMN `AR_ZERO_COUNT` INTEGER UNSIGNED AFTER `AR_NULL_PERC`,
 ADD COLUMN `AR_ZERO_PERC` DOUBLE AFTER `AR_ZERO_COUNT`,
 ADD COLUMN `AR_BLANK_COUNT` INTEGER UNSIGNED AFTER `AR_ZERO_PERC`,
 ADD COLUMN `AR_BLANK_PERC` DOUBLE AFTER `AR_BLANK_COUNT`;
 
 
CREATE TABLE `profiling`.`rules_set` (
  `RS_ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `RS_ANALYSIS_CONTENT_UD` INTEGER UNSIGNED,
  `RS_NAME` VARCHAR(100),
  `RS_DESC` MEDIUMTEXT,
  `RS_OPERATOR` INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY (`RS_ID`)
)
ENGINE = InnoDB;

CREATE TABLE `profiling`.`conditions` (
  `CND_ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `CND_RULE_SET_ID` VARCHAR(45) NOT NULL,
  `CND_VALUE1` VARCHAR(45) NOT NULL,
  `CND_VALUE2` VARCHAR(45) NOT NULL,
  `CND_OPERATOR` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`CND_ID`)
)
ENGINE = InnoDB;

CREATE TABLE `profiling`.`condition_results` (
  `CNR_ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `CNR_VALID_COUNT` INTEGER UNSIGNED,
  `CNR_VALID_PERCENT` DOUBLE,
  `CNR_DISTINCT_VALID` INTEGER UNSIGNED,
  `CNR_DISTINCT_PERCENT` DOUBLE,
  `CNR_CONDITION_ID` INTEGER UNSIGNED,
  PRIMARY KEY (`CNR_ID`)
)
ENGINE = InnoDB;


DROP TABLE IF EXISTS `profiling`.`tags`;
CREATE TABLE  `profiling`.`tags` (
  `T_ID` int(10) unsigned NOT NULL auto_increment,
  `T_CREATOR` varchar(45) default NULL,
  `T_CREATION_DATE` datetime default NULL,
  `T_UPDATE_DATE` datetime default NULL,
  `T_COMMENT` mediumtext,
  `T_RESULT_ID` int(10) unsigned default NULL,
  `T_RESULT_CONDITION_ID` int(10) unsigned default NULL,
  PRIMARY KEY  (`T_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=latin1;
